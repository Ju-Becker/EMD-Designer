!function(t){var e={};function a(s){if(e[s])return e[s].exports;var n=e[s]={i:s,l:!1,exports:{}};return t[s].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=e,a.d=function(t,e,s){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)a.d(s,n,function(e){return t[e]}.bind(null,n));return s},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="",a(a.s=0)}([function(t,e,a){"use strict";a.r(e);const s={i:"",s:"",sr:"",sm:"",t:"",tr:"",tm:""};s.i="Double click an empty space in the <b>Model</b> pane to create a state.<br>Click an object to select it.<br>Drag a state to improve readability.<br>",s.s="Press <b>DEL</b> to delete the state.<br>Press <b>INS</b> to rename the state.<br>Hold <b>CTRL</b> and click a state to create a transition.<br>Click an empty space for more options.",s.sr="Press <b>CTRL</b> + <b>l</b> (latin), <b>g</b> (greek), <b>s</b> (symbol) to choose an alphabet.<br>Enter letters (<b>a</b> or <b>A</b>) to change the name.<br>Enter numbers (<b>1</b>, <b>2</b>, <b>12</b>) to add a subscript<br>Delete with <b>BACKSPACE</b>, confirm with <b>ENTER</b> or click.",s.t="Press <b>DEL</b> to delete the transition.<br>Press <b>INS</b> to rename the transition.<br>Hold <b>t</b> to choose a transition target (<b>s</b>ource, <b>f</b>actor).<br>Click an empty space for more options.",s.tr=s.sr,s.sm=s.s,s.tm=s.t;var n=s;const i={check:"",Delete:"",rename:"",in:"",out:"",S:"",G:"",L:"",up:"",low:"",T:"",X:"",target:"",source:""};i.check="Confirm the name",i.Delete="Delete the active",i.rename="Click this button to Rename",i.in="Create a specialArrow in",i.out="Create a specialArrow out",i.S="special alphabet keyboard",i.G="greek alphabet keyboard",i.L="latin alphabet keyboard",i.up="Upper case alphabet",i.low="Lower case alphabet",i.T="Create a new Transition",i.X="Vallidate your input",i.target="Choose a new target",i.source="Choose a new source";var o=i;const r={L:{S:null,C:null},G:{S:null,C:null},S:{S:null,C:null},greek:{S:null,C:null}};r.L.S={A:119886,B:119887,C:119888,D:119889,E:119890,F:119891,G:119892,H:8462,I:119894,J:119895,K:119896,L:119897,M:119898,N:119899,O:119900,P:119901,Q:119902,R:119903,S:119904,T:119905,U:119906,V:119907,W:119908,X:119909,Y:119910,Z:119911,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.L.C={A:119860,B:119861,C:119862,D:119863,E:119864,F:119865,G:119866,H:119867,I:119868,J:119869,K:119870,L:119871,M:119872,N:119873,O:119874,P:119875,Q:119876,R:119877,S:119878,T:119879,U:119880,V:119881,W:119882,X:119883,Y:119884,Z:119885,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.G.S={A:120572,B:120573,C:120585,D:120575,E:120576,F:120593,G:120574,H:120578,I:120580,J:120589,K:120581,L:120582,M:120583,N:120584,O:120586,P:120587,Q:120579,R:120588,S:120590,T:120591,U:120592,W:120596,X:120594,Y:120595,Z:120577,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.G.C={A:120546,B:120547,C:120559,D:120549,E:120550,F:120567,G:120548,H:120552,I:120554,K:120555,L:120556,M:120557,N:120558,O:120560,P:120561,Q:120553,R:120562,S:120564,T:120565,U:120566,W:120570,X:120568,Y:120569,Z:120551,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.S.S={E:120598,F:120601,K:120600,P:120603,Q:120599,R:120602,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.S.C={Q:120563,0:8320,1:8321,2:8322,3:8323,4:8324,5:8325,6:8326,7:8327,8:8328,9:8329},r.greek.S={120572:"alpha",120573:"beta",120585:"xi",120575:"delta",120576:"epsilon",120593:"phi",120574:"gamma",120578:"eta",120580:"iota",120589:"zeta",120581:"kappa",120582:"lambda",120583:"mu",120584:"nu",120586:"o",120587:"pi",120579:"theta",120588:"rho",120590:"sigma",120591:"tau",120592:"upsilon",120596:"omega",120594:"chi",120595:"psi",120577:"zeta"};var c=r;var l={stateRadius:20,snapToPadding:6,hitTargetPadding:6,instancesLimit:1e6,specialArrowLimit:5,stateDefaultColour:"black",stateSelectedColour:"blue",stateTransitionFactorColour:"red",transitionDefaultColour:"black",transitionSelectedColour:"blue",transitionStateFactorColour:"red",stateKeys:{Rename:45,Delete:46,Transition:17},transitionKeys:{Rename:45,Delete:46,Target:84,Source:83,Factor:70},canvas:null,context:null,buildString:t=>{let e="";for(let a=0;a<t.length;a+=1)e+=String.fromCodePoint(t[a]);return e}};var d=class{constructor(t,e,a,s=l.stateRadius){this.radius=s,this.x=Math.min(e,l.canvas.width-this.radius),this.x=Math.max(this.x,this.radius),this.y=Math.min(a,l.canvas.height-this.radius),this.y=Math.max(this.y,this.radius),this.moveOffsetX=0,this.moveOffsetY=0,this.id=t,this.nameArr=[],this.name="",this.data=[],this.colour=l.stateDefaultColour,this.lineWidth=1,this.transitions={in:[],out:[],factor:[]}}transitionAdd(t,e){this.transitions[e][t.id]=t}transitionDelete(t,e){delete this.transitions[e][t.id]}updateTransitions(){let t;for(t in this.transitions.factor)this.transitions.factor[t].nameUpdate()}activate(){let t;for(t in this.colour=l.stateSelectedColour,this.transitions.factor)this.transitions.factor[t].colour=l.stateTransitionFactorColour}deactivate(){let t;for(t in this.colour=l.stateDefaultColour,this.transitions.factor)this.transitions.factor[t].colour=l.transitionDefaultColour}moveStart(t,e){this.moveOffsetX=t-this.x,this.moveOffsetY=e-this.y}move(t,e){let a;for(a in this.x=t-this.moveOffsetX,this.y=e-this.moveOffsetY,this.x=Math.min(this.x,l.canvas.width-this.radius),this.x=Math.max(this.x,this.radius),this.y=Math.min(this.y,l.canvas.height-this.radius),this.y=Math.max(this.y,this.radius),this.transitions.in)this.transitions.in[a].updateShape();for(a in this.transitions.out)this.transitions.out[a].updateShape()}moveStop(){this.moveOffsetX=0,this.moveOffsetY=0}nameAddChr(t){this.nameArr.push(t),this.name+=String.fromCodePoint(t)}nameRemoveChr(){return 0!==this.nameArr.length&&(this.nameArr.pop(),this.name=l.buildString(this.nameArr),!0)}draw(){if(0!==this.radius){const t=l.context;t.lineWidth=this.lineWidth,t.strokeStyle=this.colour,t.fillStyle=this.colour,t.font="20px Verdana, Geneva, Tahoma, sans-serif",t.textAlign="center",t.textBaseline="middle",t.beginPath(),t.arc(this.x,this.y,this.radius,0,2*Math.PI),t.stroke(),t.fillText(this.name,this.x,this.y)}}closestPointOnCircle(t,e){const a=t-this.x,s=e-this.y,n=Math.sqrt(a*a+s*s);return{x:this.x+a*this.radius/n,y:this.y+s*this.radius/n}}};let u={},h={};function p(t){return t.preventDefault(),0!==t.button||(u.mouseDown(t),h.focus()),!1}function m(t){return t.preventDefault(),!1}function f(t){return t.preventDefault(),!1}function b(t){return t.preventDefault(),u.dblClick(t),!1}function v(t){return t.preventDefault(),0===t.button&&u.mouseCancel(t),!1}function g(t){u.mouseCancel(t)}function y(t){u.mouseMove(t)}function S(t){return t.preventDefault(),u.keyDown(t),!1}function I(t){u.keyUp(t)}var k=function(t,e){h=t,u=e,h.addEventListener("mousedown",p),h.addEventListener("click",m),h.addEventListener("dblclick",b),h.addEventListener("contextmenu",f),h.addEventListener("mousemove",y),h.addEventListener("mouseup",v),h.addEventListener("mouseout",g),h.addEventListener("keydown",S),h.addEventListener("keyup",I)};let w={};const D={};let C={},E={};function x(){let t;return t="s"===C.state?C.selectionTransitionTarget?"t":"i":"sm"===C.state?"m":"sr"===C.state?"r":null,t}D.mouseDown=t=>{switch(x()){case"i":C.systemStateMouseDown(t.offsetX,t.offsetY);break;case"t":E.stateSelectTransitionTarget(t);break;case"r":E.stateRenameExitSelect(t)}},D.mouseMove=t=>{"m"===x()&&C.moveObject(t)},D.mouseCancel=()=>{"m"===x()&&C.moveStop()},D.keyDown=t=>{const e=x(),a=t.keycode||t.which;switch(e){case"i":!function(t){switch(t){case w.Transition:E.stateActivateTransition();break;case w.Rename:E.stateActivateRename();break;case w.Delete:E.stateActivateDelete()}}(a);break;case"r":E.renameKeyDown(t)}},D.keyUp=t=>{const e=x(),a=t.keycode||t.which;"t"===e&&a===w.Transition&&E.stateActivateIdle()},D.init=(t,e,a)=>{C=t,w=a,E=e};var A=D;let R={};const M={};let B={},T={};function O(){let t;return t="t"===B.state?B.selectionTransitionTarget?"t":B.selectionTransitionSource?"s":B.selectionTransitionFactor?"f":"i":"tm"===B.state?"m":"tr"===B.state?"r":null,t}M.mouseDown=t=>{switch(O()){case"i":B.systemStateMouseDown(t.offsetX,t.offsetY);break;case"t":T.transitionSelectTarget(t);break;case"s":T.transitionSelectSource(t);break;case"f":T.transitionSelectFactor(t);break;case"r":T.transitionRenameExitSelect(t)}},M.mouseMove=t=>{"m"===O()&&B.moveObject(t)},M.mouseCancel=()=>{"m"===O()&&B.moveStop()},M.keyDown=t=>{switch(O()){case"i":!function(t){switch(t.keycode||t.which){case R.Target:T.transitionActivateTarget();break;case R.Source:T.transitionActivateSource();break;case R.Factor:T.transitionActivateFactor();break;case R.Rename:T.transitionActivateRename();break;case R.Delete:T.transitionActivateDelete()}}(t)}},M.keyUp=t=>{const e=O(),a=t.keycode||t.which;("t"===e&&a===R.Target||"s"===e&&a===R.Source||"f"===e&&a===R.Factor)&&T.transitionActivateIdle()},M.init=(t,e,a)=>{B=t,T=e,R=a};var P=M;const L={};let X={},j={},K={};L.mouseDown=t=>{X.systemStateMouseDown(t.offsetX,t.offsetY)},L.dblClick=t=>{t.shiftKey?K.specialstatecreate(t,"special"):j.stateCreate(t)},L.init=(t,e,a)=>{X=t,j=e,K=a};var H=L;const G={};let V={};function N(){let t;switch(V.state){case"s":case"sr":case"sm":t="s";break;case"t":case"tr":case"tm":t="t";break;case"i":t="i"}return t}G.mouseDown=t=>{switch(N()){case"i":H.mouseDown(t);break;case"s":A.mouseDown(t);break;case"t":P.mouseDown(t)}},G.dblClick=t=>("i"!==N()||H.dblClick(t),!1),G.mouseCancel=()=>{switch(N()){case"s":A.mouseCancel();break;case"t":P.mouseCancel()}},G.mouseMove=t=>{switch(N()){case"s":A.mouseMove(t);break;case"t":P.mouseMove(t)}},G.keyDown=t=>{switch(N()){case"s":A.keyDown(t);break;case"t":P.keyDown(t)}},G.keyUp=t=>{switch(N()){case"s":A.keyUp(t);break;case"t":P.keyUp(t)}};var F=function(t,e,a,s,n,i,o){k(t,G),V=e,H.init(V,a,s),A.init(V,a,i),P.init(V,n,o)};let U={},z={},Y=0,J=0,_=100;const q={s:0,t:0},W={};function Z(t,e,a){return U.beginPath(),U.arc(a.x,a.y,J,0,2*Math.PI),U.closePath(),!!U.isPointInPath(t,e)}function Q(t,e,a){const s=a.shape.source.point,n=a.shape.target.point,i=n.x-s.x,o=n.y-s.y,r=Math.sqrt(i*i+o*o),c=(i*(t-s.x)+o*(e-s.y))/(r*r),l=(i*(e-s.y)-o*(t-s.x))/r;return c>0&&c<1&&Math.abs(l)<Y}W.shMap=new Map,W.getShape=t=>W.shMap.get(t),W.findShape=(t,e)=>{let a,s,n;for([a,n]of W.shMap)switch(s=a.substring(0,1),s){case"s":if(Z(t,e,n))return n;break;case"t":if(Q(t,e,n))return n}return null},W.stateconflict=t=>{let e,a,s;const n=t.id;for([e,a]of W.shMap)switch(s=e.substring(0,1),s){case"s":if((t.x-a.x)*(t.x-a.x)+(t.y-a.y)*(t.y-a.y)<=4*J*J&&n!==e)return!0}return!1},W.findStateNameConflict=t=>{let e,a;const s=t.id,n=t.name;for([e,a]of W.shMap)if("s"===e.substring(0,1)&&a.name===n&&e!==s)return a;return null},W.generateFreeID=t=>q[t]>=_?"":(q[t]+=1,t+(q[t]-1)),W.draw=()=>{let t;for(t of(U.clearRect(0,0,z.width,z.height),W.shMap.values()))t.draw()},W.addShape=(t,e)=>{W.shMap.set(t,e)},W.deleteShape=t=>{W.shMap.delete(t)},W.init=(t,e,a,s)=>{z=t,U=z.getContext("2d"),J=e,Y=a,_=s};var tt=W;let et={},at={},st={},nt={},it=0;const ot={stateSelectTransitionTarget:t=>{const e=at.activeShape,a=et.findShape(t.offsetX,t.offsetY);if(null==a||"s"!==a.id.substring(0,1)||a.id===e.id)return;e.deactivate();const s=st.transitionCreate(e,a);null!==s&&(at.systemStateActivate("tr",s),et.draw())},renameKeyDown:t=>{let e=t.keyCode||t.which;const a=at.activeShape;if(13===e&&ot.renameValidate())return at.systemStateActivate("s",a),et.draw(),!0;if(t.ctrlKey)return e=String.fromCharCode(e),"L"!==e&&"G"!==e&&"S"!==e||(at.alphabet=e),!0;if(8===e)return a.nameRemoveChr(),et.draw(),!0;e=String.fromCharCode(e);const s=at.symbols[at.alphabet][t.shiftKey?"C":"S"][e];return void 0===s||(a.nameAddChr(s),et.draw()),!0},stateName:t=>"sr"===at.state&&(at.activeShape.nameAddChr(t),et.draw(),!0),nameRemoveToken:()=>(at.activeShape.nameRemoveChr(),et.draw(),!0),checkName:()=>{if(ot.renameValidate())return at.systemStateActivate("s",at.activeShape),et.draw(),!0},stateRenameExitSelect:t=>{ot.renameValidate()&&at.systemStateMouseDown(t.offsetX,t.offsetY)},renameValidate:()=>{const t=at.activeShape;if(0===t.name.length)return alert("Please provide a name!"),!1;if("𝑁"===t.name)return alert("The name 𝑁 is blocked!"),!1;if(null!==et.findStateNameConflict(t))return alert("There already exists a state with this name!"),!1;if(t.name!==at.nameOld){let e=nt.returncapacitystatesbystate(t),a=8320;for(let s=0;s<e.length;s++)a++,e[s].name=t.name.concat([String.fromCodePoint(a)]),e[s].nameArr=t.nameArr.concat([a]),et.draw();t.updateTransitions(),at.callback(et.shMap)}return!0},stateActivateTransition:()=>{at.selectionTransitionTarget=!0},stateActivateRename:()=>{at.systemStateActivate("sr",at.activeShape)},stateActivateDelete:()=>{"s0"!==at.activeShape.id&&(ot.stateDelete(at.activeShape),at.systemStateActivate("i",null),et.draw())},stateActivateIdle:()=>{at.selectionTransitionTarget=!1},stateCreate:t=>{const e=et.generateFreeID("s");if(0===e.length)return alert("Only "+it+" states allowed, limit reached!"),!1;const a=new d(e,t.offsetX,t.offsetY);return et.stateconflict(a)?(alert("Collision with another State"),!1):(et.addShape(e,a),at.systemStateActivate("sr",a),et.draw(),!1)},stateDelete:t=>{let e,a=nt.returncapacitystatesbystate(t);for(e in t.deactivate(),t.transitions.in)st.transitionDelete(et.getShape(e),!1);for(e in t.transitions.out)st.transitionDelete(et.getShape(e),!1);for(e in t.transitions.factor)st.transitionDelete(et.getShape(e),!1);et.deleteShape(t.id);for(let t=0;t<a.length;t++)ot.stateDelete(a[t]);at.callback(et.shMap)},init:(t,e,a,s,n)=>{et=t,at=e,st=a,nt=s,it=n}};var rt=ot;var ct=class{constructor(t,e,a){this.id=t,this.nameArr=[],this.name="",this.colour=l.transitionDefaultColour,this.lineWidth=1,this.shape={source:{point:{x:0,y:0}},target:{point:{x:0,y:0}}},this.factors=[],e.transitionAdd(this,"out"),a.transitionAdd(this,"in"),this.source=e,this.target=a,this.updateShape()}delete(){let t;for(t in this.deactivate(),this.source.transitionDelete(this,"out"),this.target.transitionDelete(this,"in"),this.factors)this.factors[t].transitionDelete(this,"factor")}setTarget(t){this.target.transitionDelete(this,"in"),this.target=t,t.transitionAdd(this,"in"),this.updateShape()}setSource(t){this.source.transitionDelete(this,"out"),this.source=t,t.transitionAdd(this,"out"),this.updateShape()}activate(){let t;for(t in this.colour=l.transitionSelectedColour,this.factors)this.factors[t].colour=l.transitionStateFactorColour}deactivate(){let t;for(t in this.colour=l.transitionDefaultColour,this.factors)this.factors[t].colour=l.stateDefaultColour}moveStart(t,e){}move(t,e){}moveStop(){}updateShape(){const t=(this.source.x+this.target.x)/2,e=(this.source.y+this.target.y)/2;this.shape.source.point=this.source.closestPointOnCircle(t,e),this.shape.target.point=this.target.closestPointOnCircle(t,e)}nameUpdate(){let t,e,a;const s=this.nameArr,n=s.length;for(this.name="",t=0;t<n;t+=1)[e,a]=s[t],this.name+="s"!==e?String.fromCodePoint(a):a.name}factorUpdate(){let t,e,a;const s=this.nameArr,n=s.length;for(t in this.factors)this.factors[t].transitionDelete(this,"factor"),this.factors[t].colour=l.stateDefaultColour;for(this.factors=[],t=0;t<n;t+=1)[e,a]=s[t],"s"===e&&(this.factors[a.id]=a,a.transitionAdd(this,"factor"),a.colour=l.transitionStateFactorColour)}nameAddToken(t,e){const a=this.nameArr,s=a.length,n=s>0?a[s-1][0]:"";return("o"!==t||"o"!==n)&&(this.nameArr.push([t,e]),this.nameUpdate(),this.factorUpdate(),!0)}nameRemoveToken(){return 0!==this.nameArr.length&&(this.nameArr.pop(),this.nameUpdate(),this.factorUpdate(),!0)}nameNormalize(){const t=this.nameArr,e=t.length;e>0&&"o"===t[e-1][0]&&this.nameRemoveToken()}draw(){const t=l.context;t.lineWidth=this.lineWidth,t.strokeStyle=this.colour,t.fillStyle=this.colour,t.font="20px Verdana, Geneva, Tahoma, sans-serif",t.textAlign="center",t.textBaseline="middle",t.beginPath(),t.moveTo(this.shape.source.point.x,this.shape.source.point.y),t.lineTo(this.shape.target.point.x,this.shape.target.point.y),t.stroke();let e=this.shape.target.point.x-this.shape.source.point.x,a=this.shape.target.point.y-this.shape.source.point.y;const s=Math.sqrt(e*e+a*a);e/=s,a/=s,t.beginPath(),t.moveTo(this.shape.target.point.x,this.shape.target.point.y),t.lineTo(this.shape.target.point.x-8*e+5*a,this.shape.target.point.y-8*a-5*e),t.lineTo(this.shape.target.point.x-8*e-5*a,this.shape.target.point.y-8*a+5*e),t.fill();let n=(this.shape.source.point.x+this.shape.target.point.x)/2,i=(this.shape.source.point.y+this.shape.target.point.y)/2;n+=15*a,i+=-15*e,t.fillText(this.name,n,i)}};let lt={},dt={},ut={},ht={},pt=0;const mt={transitionCreate:(t,e)=>{const a=lt.generateFreeID("t");if(0===a.length)return alert("Only "+pt+" transitions allowed, limit reached!"),null;if(void 0!==t.max)return null;if(ht.inserttransitionlimitreached(e)&&void 0!==e.max)return null;const s=new ct(a,t,e);return lt.addShape(a,s),s},transitionSelectTarget:t=>{ut.rearrangement();const e=lt.findShape(t.offsetX,t.offsetY);if(null===e)return;if("s"!==e.id.substring(0,1))return;if(e.id===dt.activeShape.source.id)return;if(e.id===dt.activeShape.target.id)return;if(ut.limitspAinreached(e))return void alert("limit reached");if(void 0!==e.capacitystate)return;if(ht.inserttransitionlimitreached(e)&&(void 0!==e.max||void 0!==e.capacitystate))return;let a=ht.returncapacitytransitionsbystate(e);for(let t=0;t<a.length;t++)a[t].name=dt.activeShape.name,a[t].nameArr=dt.activeShape.nameArr;dt.activeShape.deactivate(),dt.activeShape.setTarget(e),dt.activeShape.activate(),ut.arrangement(),dt.callback(lt.shMap),lt.draw()},transitionSelectSource:t=>{ut.rearrangement();const e=lt.findShape(t.offsetX,t.offsetY);null!=e&&"s"===e.id.substring(0,1)&&e.id!==dt.activeShape.source.id&&e.id!==dt.activeShape.target.id&&(ut.limitspAoutreached(e)?alert("limit reached"):void 0===e.capacitystate&&void 0===e.type&&(dt.activeShape.deactivate(),dt.activeShape.setSource(e),dt.activeShape.activate(),ut.arrangement(),dt.callback(lt.shMap),lt.draw()))},transitionSelectFactor:t=>{const e=lt.findShape(t.offsetX,t.offsetY);null!==e&&"s"===e.id.substring(0,1)&&(dt.activeShape.deactivate(),dt.activeShape.toggleFactor(e),dt.activeShape.activate(),dt.callback(lt.shMap),lt.draw())},transitionActivateTarget:()=>{dt.selectionTransitionTarget=!0},transitionActivateSource:()=>{dt.selectionTransitionSource=!0},transitionActivateFactor:()=>{dt.selectionTransitionFactor=!0},transitionActivateDelete:()=>{mt.transitionDelete(dt.activeShape),dt.systemStateActivate("i",null),lt.draw()},transitionActivateIdle:()=>{dt.selectionTransitionTarget=!1,dt.selectionTransitionSource=!1,dt.selectionTransitionFactor=!1},transitionDelete:(t,e=!0)=>{t.delete(),lt.deleteShape(t.id),e&&dt.callback(lt.shMap)},transitionActivateRename:()=>{dt.systemStateActivate("tr",dt.activeShape)},nameValidate:()=>{const t=dt.activeShape;if(0===t.name.length)return alert("Please provide a name!"),!1;if(t.name!==dt.nameOld){let t=ht.returncapacitytransitionsbytransition(dt.activeShape);for(let e=0;e<t.length;e++)t[e].name=dt.activeShape.name,t[e].nameArr=dt.activeShape.nameArr;dt.callback(lt.shMap)}return!0},nameAppendRate:t=>"tr"===dt.state&&(dt.activeShape.nameAddToken("r",t),lt.draw(),!0),nameAppendPlus:()=>"tr"===dt.state&&(dt.activeShape.nameAddToken("o",65291),lt.draw(),!0),nameConfirm:()=>"tr"===dt.state&&(dt.activeShape.nameNormalize(),lt.draw(),!!mt.nameValidate()&&(dt.systemStateActivate("t",dt.activeShape),lt.draw(),!0)),transitionRenameExitSelect:t=>{dt.activeShape.nameNormalize(),mt.nameValidate()&&dt.systemStateMouseDown(t.offsetX,t.offsetY)},nameAppendState:t=>"tr"===dt.state&&(dt.activeShape.nameAddToken("s",t),lt.draw(),!0),nameRemoveToken:()=>"tr"===dt.state&&(dt.activeShape.nameRemoveToken(),lt.draw(),!0),init:(t,e,a,s,n)=>{lt=t,dt=e,pt=a,ut=s,ht=n}};var ft=mt;const bt=[],vt={addListener:t=>{bt.push(t)},update:t=>{bt.forEach(e=>{e(t)})}};var gt=vt;let yt="http://www.w3.org/2000/svg",St=35;const It={setNS:t=>{yt=t},getNS:()=>yt,setKeySize:t=>{St=t},getKeySize:()=>St,createKey:function(t,e,a){const s=document.createElementNS(yt,"g");return s.setAttributeNS(null,"transform","translate("+t+","+e+")"),s.appendChild(function(){const t=document.createElementNS(yt,"rect");return t.setAttributeNS(null,"x",0),t.setAttributeNS(null,"y",0),t.setAttributeNS(null,"width",St),t.setAttributeNS(null,"height",St),t.style.strokeWidth=1,t.style.stroke="black",t.setAttributeNS(null,"fill","white"),t}()),s.appendChild(function(t){const e=document.createElementNS(yt,"text");return e.setAttributeNS(null,"x",.5*St),e.setAttributeNS(null,"y",.5*St),e.style.textAnchor="middle",e.style.alignmentBaseline="central",e.style.font="20px Verdana, Geneva, Tahoma, sans-serif",e.style.fill="black",e.style.pointerEvents="none",e.innerHTML=t,e}(a)),s}};var kt=It;let wt="http://www.w3.org/2000/svg",Dt=35,Ct=13;const Et={check:null,del:null,plus:null,L:null,G:null,S:null,up:null,low:null,Del:null,R:null,T:null,X:null,target:null,source:null,in:null,out:null,checkenter:null,Deleteenter:null,Renter:null,inenter:null,outenter:null,Lenter:null,Genter:null,Senter:null,upenter:null,lowenter:null,Tenter:null,Xenter:null,targetenter:null,sourceenter:null},xt=10003,At=11013,$t=65291,Rt=76,Mt=71,Bt=83,Tt=8593,Ot=8595,Pt=9249,Lt=82,Xt=8594,jt=88,Kt=8614,Ht=8620,Gt=8681,Vt=8679;function Nt(t,e){e.addEventListener("mousedown",e=>(e.preventDefault(),0!==e.button||Et[t](),!1))}function Ft(t,e){e.addEventListener("mouseenter",e=>(e.preventDefault(),0!==e.button||Et[t](),!1))}const Ut={setNS:t=>{wt=t},getNS:()=>wt,setKeySize:t=>{Dt=t},getKeySize:()=>Dt,setColoumnCount:t=>{Ct=t},getColoumnCount:()=>Ct,setHandler:(t,e)=>{Et[t]=e},getHandler:t=>Et[t],create:function(t,e,a){let s,n;kt.setKeySize(Dt),kt.setNS(wt);const i=document.createElementNS(wt,"g");switch(i.setAttributeNS(null,"transform","translate("+t+","+e+")"),a){case"s":n=String.fromCodePoint(Pt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("Del",s),Ft("Deleteenter",s),i.appendChild(s),n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),Ft("Renter",s),i.appendChild(s),n=String.fromCodePoint(Xt),s=kt.createKey(Dt*(Ct-11),0,n),Nt("T",s),Ft("Tenter",s),i.appendChild(s),n=String.fromCodePoint(Gt),s=kt.createKey(Dt*(Ct-10),0,n),Nt("in",s),Ft("inenter",s),i.appendChild(s),n=String.fromCodePoint(Vt),s=kt.createKey(Dt*(Ct-9),0,n),Nt("out",s),Ft("outenter",s),i.appendChild(s);break;case"sspecial":n=String.fromCodePoint(Pt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("Del",s),Ft("Deleteenter",s),i.appendChild(s),n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),Ft("Renter",s),i.appendChild(s);break;case"cspecial":n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),Ft("Renter",s),i.appendChild(s),n=String.fromCodePoint(Xt),s=kt.createKey(Dt*(Ct-11),0,n),Nt("T",s),Ft("Tenter",s),i.appendChild(s),n=String.fromCodePoint(Gt),s=kt.createKey(Dt*(Ct-10),0,n),Nt("in",s),Ft("inenter",s),i.appendChild(s),n=String.fromCodePoint(Vt),s=kt.createKey(Dt*(Ct-9),0,n),Nt("out",s),Ft("outenter",s),i.appendChild(s);break;case"t":n=String.fromCodePoint(Pt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("Del",s),Ft("Deleteenter",s),i.appendChild(s),n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),i.appendChild(s),Ft("Renter",s),n=String.fromCodePoint(Kt),s=kt.createKey(Dt*(Ct-11),0,n),Nt("target",s),Ft("targetenter",s),i.appendChild(s),n=String.fromCodePoint(Ht),s=kt.createKey(Dt*(Ct-10),0,n),Nt("source",s),Ft("sourceenter",s),i.appendChild(s);break;case"tspecialin":n=String.fromCodePoint(Pt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("Del",s),Ft("Deleteenter",s),i.appendChild(s),n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),Ft("Renter",s),i.appendChild(s),n=String.fromCodePoint(Kt),s=kt.createKey(Dt*(Ct-11),0,n),Nt("target",s),Ft("targetenter",s),i.appendChild(s);break;case"tspecialout":n=String.fromCodePoint(Pt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("Del",s),Ft("Deleteenter",s),i.appendChild(s),n=String.fromCodePoint(Lt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("R",s),Ft("Renter",s),i.appendChild(s),n=String.fromCodePoint(Ht),s=kt.createKey(Dt*(Ct-10),0,n),Nt("source",s),Ft("sourceener",s),i.appendChild(s);break;case"X":n=String.fromCodePoint(jt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("X",s),Ft("Xenter",s),i.appendChild(s);break;case"name":n=String.fromCodePoint($t),s=kt.createKey(Dt*(Ct-5),0,n),Nt("plus",s),i.appendChild(s),n=String.fromCodePoint(At),s=kt.createKey(Dt*(Ct-3),0,n),Nt("del",s),i.appendChild(s),n=String.fromCodePoint(xt),s=kt.createKey(Dt*(Ct-1),0,n),Nt("check",s),Ft("checkenter",s),i.appendChild(s),n=String.fromCodePoint(Rt),s=kt.createKey(Dt*(Ct-13),0,n),Nt("L",s),Ft("Lenter",s),i.appendChild(s),n=String.fromCodePoint(Mt),s=kt.createKey(Dt*(Ct-12),0,n),Nt("G",s),Ft("Genter",s),i.appendChild(s),n=String.fromCodePoint(Bt),s=kt.createKey(Dt*(Ct-11),0,n),Nt("S",s),Ft("Senter",s),i.appendChild(s),n=String.fromCodePoint(Tt),s=kt.createKey(Dt*(Ct-9),0,n),Nt("up",s),Ft("upenter",s),i.appendChild(s),n=String.fromCodePoint(Ot),s=kt.createKey(Dt*(Ct-8),0,n),Nt("low",s),Ft("lowenter",s),i.appendChild(s)}return i}};var zt=Ut;let Yt="http://www.w3.org/2000/svg",Jt=35,_t=13,qt=null;function Wt(t,e){e.addEventListener("mousedown",e=>(e.preventDefault(),0!==e.button||qt(t),!1))}const Zt={setNS:t=>{Yt=t},getNS:()=>Yt,setKeySize:t=>{Jt=t},getKeySize:()=>Jt,setColoumnCount:t=>{_t=t},getColoumnCount:()=>_t,setHandler:t=>{qt=t},getHandler:()=>qt,createAlphabet:function(t,e,a,s){let n,i,o,r,l=0,d=0,u=65;kt.setKeySize(Jt),kt.setNS(Yt);const h=document.createElementNS(Yt,"g");for(h.setAttributeNS(null,"transform","translate("+t+","+e+")");u<91;)n=String.fromCharCode(u),i=c[a][s][n],void 0!==i&&(o=String.fromCodePoint(i),r=kt.createKey(d*Jt,l*Jt,o),Wt(i,r),h.appendChild(r),d+=1,d===_t&&(d=0,l+=1)),u+=1;return h}};var Qt=Zt;let te=35,ee=13,ae="http://www.w3.org/2000/svg",se=null;const ne={};function ie(t,e){e.addEventListener("mousedown",e=>(e.preventDefault(),0!==e.button||se(t),!1))}ne.setNS=t=>{ae=t},ne.getNS=()=>ae,ne.setKeySize=t=>{te=t},ne.getKeySize=()=>te,ne.setColoumnCount=t=>{ee=t},ne.getColoumnCount=()=>ee,ne.getHandler=()=>se,ne.setHandler=t=>{se=t},ne.create=function(t,e,a){let s,n,i,o=0,r=0;kt.setKeySize(te),kt.setNS(ae);const c=document.createElementNS(ae,"g");for([s,n]of(c.setAttributeNS(null,"transform","translate("+t+","+e+")"),a))"n"===s.substring(0,1)&&(i=kt.createKey(r*te,o*te,n.name),ie(n,i),c.appendChild(i),r+=1,r===ee&&(r=0,o+=1)),"s"===s.substring(0,1)&&(i=kt.createKey(r*te,o*te,n.name),ie(n,i),c.appendChild(i),r+=1,r===ee&&(r=0,o+=1));return c};var oe=ne;let re="http://www.w3.org/2000/svg",ce=13,le=35,de=10,ue=null,he=null,pe=null,me=null,fe=null,be=null,ve=null;const ge={plus:null,del:null,check:null,L:null,G:null,S:null,up:null,low:null,Del:null,R:null,T:null,X:null,target:null,source:null,in:null,out:null,checkenter:null,Deleteenter:null,Renter:null,inenter:null,outenter:null,Lenter:null,Genter:null,Senter:null,upenter:null,lowenter:null,Tenter:null,Xenter:null,targetenter:null,sourceenter:null};let ye=[10,55];const Se={};function Ie(){oe.setColoumnCount(ce),oe.setKeySize(le),oe.setNS(re),oe.setHandler(ve)}function ke(t){Ie();const e=oe.create(ye[0],ye[1],t);null!==me&&he.removeChild(me),he.appendChild(e),me=e}Se.updateAlphabet=(t,e)=>{he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,t,e),he.appendChild(pe)},Se.Alphabetvisibility=t=>{pe.setAttributeNS(null,"visibility",t)},Se.updateAlphabetCase=t=>{if("up"==t){let t=pe.getElementsByTagName("text")[0].innerHTML;switch(t=t.charCodeAt(1),t){case 56398:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"L","C"),he.appendChild(pe);break;case 57084:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"G","C"),he.appendChild(pe);break;case 57110:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"S","C"),he.appendChild(pe)}}else{let t=pe.getElementsByTagName("text")[0].innerHTML;switch(t=t.charCodeAt(1),t){case 56372:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"L","S"),he.appendChild(pe);break;case 57058:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"G","S"),he.appendChild(pe);break;case 57075:he.removeChild(pe),pe=Qt.createAlphabet(de,2*de+le,"S","S"),he.appendChild(pe)}}},Se.updateSpecialKeys=t=>{he.removeChild(fe),fe=zt.create(de,de,t),he.appendChild(fe)},Se.StateKeysvisibility=t=>{me.setAttributeNS(null,"visibility",t)},Se.visibility=t=>{he.setAttributeNS(null,"visibility",t)},Se.init=(t,e)=>{ue=t,function(){const t=2*de+le*ce,e=4*de+5*le;he=document.createElementNS(re,"svg"),he.setAttributeNS(null,"width",t+"px"),he.setAttributeNS(null,"height",e+"px")}(),zt.setKeySize(le),zt.setNS(re),zt.setColoumnCount(ce),zt.setHandler("plus",ge.plus),zt.setHandler("del",ge.del),zt.setHandler("check",ge.check),zt.setHandler("L",ge.L),zt.setHandler("G",ge.G),zt.setHandler("S",ge.S),zt.setHandler("up",ge.up),zt.setHandler("low",ge.low),zt.setHandler("Del",ge.Del),zt.setHandler("R",ge.R),zt.setHandler("T",ge.T),zt.setHandler("X",ge.X),zt.setHandler("target",ge.target),zt.setHandler("source",ge.source),zt.setHandler("in",ge.in),zt.setHandler("out",ge.out),zt.setHandler("checkenter",ge.checkenter),zt.setHandler("Deleteenter",ge.Deleteenter),zt.setHandler("Renter",ge.Renter),zt.setHandler("inenter",ge.inenter),zt.setHandler("outenter",ge.outenter),zt.setHandler("Senter",ge.Senter),zt.setHandler("Genter",ge.Genter),zt.setHandler("Lenter",ge.Lenter),zt.setHandler("upenter",ge.upenter),zt.setHandler("lowenter",ge.lowenter),zt.setHandler("Tenter",ge.Tenter),zt.setHandler("Xenter",ge.Xenter),zt.setHandler("targetenter",ge.targetenter),zt.setHandler("sourceenter",ge.sourceenter),Qt.setColoumnCount(ce),Qt.setKeySize(le),Qt.setNS(re),Qt.setHandler(be),Ie(),e.addListener(ke),ye=[de,3*de+3*le],fe=zt.create(de,de,"name"),he.appendChild(fe),pe=Qt.createAlphabet(de,2*de+le,"L","C"),he.appendChild(pe),ue.appendChild(he),he.setAttributeNS(null,"visibility","hidden"),document.getElementById("inID").style.visibility="hidden"},Se.setNS=t=>{re=t},Se.getNS=()=>re,Se.setKeySize=t=>{le=t},Se.getKeySize=()=>le,Se.setColoumnCount=t=>{ce=t},Se.getColoumnCount=()=>ce,Se.setAlphabetHandler=t=>{be=t},Se.getAlphabetHandler=()=>be,Se.setStateKeyHandler=t=>{ve=t},Se.getStateKeyHandler=()=>ve,Se.setPadding=t=>{de=t},Se.setSpecialKeyHandler=(t,e)=>{ge[t]=e},Se.getSpecialKeyHandler=t=>ge[t],Se.getPadding=()=>de;var we=Se;let De={},Ce={},Ee={},xe={},Ae={},$e=0;const Re={updateAlphabetL:()=>{we.updateAlphabet("L","C")},updateAlphabetG:()=>{we.updateAlphabet("G","S")},updateAlphabetS:()=>{we.updateAlphabet("S","S")},updateAlphabetlow:()=>{we.updateAlphabetCase("low")},updateAlphabetup:()=>{we.updateAlphabetCase("up")},letterIn:t=>{switch(De.state[0]){case"s":Ee.stateName(t);break;case"t":Ce.nameAppendRate(t)}},RemoveTolken:()=>{switch(De.state){case"sr":Ee.nameRemoveToken();break;case"tr":Ce.nameRemoveToken()}},check:()=>{switch(De.state[0]){case"s":Ee.checkName();break;case"t":Ce.nameConfirm()}},delete:()=>{switch(De.state[0]){case"s":Ee.stateActivateDelete();break;case"t":xe.rearrangement(),Ce.transitionActivateDelete()}},rename:()=>{switch(De.state[0]){case"s":Ee.stateActivateRename();break;case"t":Ce.transitionActivateRename()}},arrowIn:()=>{xe.specialArrowCreate("in")},arrowOut:()=>{xe.specialArrowCreate("out")},newTransition:()=>{Ee.stateActivateTransition(),we.updateSpecialKeys("X")},leaveX:()=>{switch(De.state){case"s":Ee.stateActivateIdle(),we.updateSpecialKeys("s"),Re.systemupdate("s");break;case"t":Ce.transitionActivateIdle(),we.updateSpecialKeys("t"),Re.systemupdate("t")}},transitiontarget:()=>{Ce.transitionActivateTarget(),we.updateSpecialKeys("X")},transitionsource:()=>{Ce.transitionActivateSource(),we.updateSpecialKeys("X")},showinfo:t=>{let e=window.event,a=document.getElementById("infoID");a.style.left=e.clientX+"px";let s=e.clientY-50;a.style.top=s+"px",a.style.visibility="visible",a.innerHTML=t,0===$e&&($e++,setTimeout((function(){a.style.visibility="hidden",$e=0}),1250))},systemupdate:t=>{let e=document.getElementById("inID");switch(t){case"s":"special"===De.activeShape.type?(e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("sspecial"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden")):void 0!==De.activeShape.capacitystate?(e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("cspecial"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden")):(e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("s"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden"));break;case"sr":e.style.visibility="visible",we.visibility("visible"),Re.updateAlphabetL(),we.Alphabetvisibility("visible"),we.updateSpecialKeys("name"),we.StateKeysvisibility("hidden");break;case"sm":e.style.visibility="hidden",we.visibility("hidden"),we.Alphabetvisibility("hidden");break;case"t":switch(De.activeShape.type){case void 0:e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("t"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden");break;case"in":e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("tspecialin"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden");break;case"out":e.style.visibility="visible",we.visibility("visible"),we.updateSpecialKeys("tspecialout"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden")}void 0!==De.activeShape.capacitystate&&(e.style.visibility="hidden",we.visibility("hidden"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden"));break;case"tr":e.style.visibility="visible",we.visibility("visible"),Re.updateAlphabetG(),we.Alphabetvisibility("visible"),we.updateSpecialKeys("name"),we.StateKeysvisibility("visible");break;case"tm":case"i":e.style.visibility="hidden",we.visibility("hidden"),we.Alphabetvisibility("hidden"),we.StateKeysvisibility("hidden")}},checkenter:()=>{let t=Ae.check;Re.showinfo(t)},Deleteenter:()=>{let t=Ae.Delete;switch(De.state){case"s":t+=" state";break;case"t":void 0!==De.activeShape.type?t+=" special arrow":t+=" transition"}Re.showinfo(t)},Renter:()=>{let t=Ae.rename;Re.showinfo(t)},inenter:()=>{let t=Ae.in;Re.showinfo(t)},outenter:()=>{let t=Ae.out;Re.showinfo(t)},Senter:()=>{let t=Ae.S;Re.showinfo(t)},Genter:()=>{let t=Ae.G;Re.showinfo(t)},Lenter:()=>{let t=Ae.L;Re.showinfo(t)},upenter:()=>{let t=Ae.up;Re.showinfo(t)},lowenter:()=>{let t=Ae.low;Re.showinfo(t)},Tenter:()=>{let t=Ae.T;Re.showinfo(t)},Xenter:()=>{let t=Ae.X;Re.showinfo(t)},tagetenter:()=>{let t=Ae.target;Re.showinfo(t)},sourceenter:()=>{let t=Ae.source;Re.showinfo(t)},init:(t,e,a,s,n)=>{De=t,Ce=e,Ee=a,xe=s,Ae=n}};var Me=Re;var Be=class extends ct{constructor(t,e,a,s){super(t,e,a),this.type=s}};let Te={},Oe={},Pe=0;const Le={returnstates:t=>{let e,a,s,n=[];for([e,a]of Te.shMap)s=e.substring(0,1),"t"===s&&void 0!==a.type&&(a.source===t?n.push(a.target):a.target===t&&n.push(a.source));return n},specialArrowCreate:t=>{const e=Te.generateFreeID("s"),a=Te.generateFreeID("t");let s,n=Oe.activeShape.x,i=Oe.activeShape.y,o=0,r=0,c=0,l=0;const u=Le.returnstates(Oe.activeShape);for(let t=0;t<u.length;t++)Oe.activeShape.x-u[t].x<=0&&Oe.activeShape.y-u[t].y>0||u[t].x-Oe.activeShape.x>0&&u[t].y-Oe.activeShape.y>0?c++:l++;if(c===Pe&&"in"===t||l===Pe&&"out"===t)return alert("Only "+Pe+" specialArrows allowed, limit reached!"),null;const h=Math.PI/Pe;switch(t){case"in":o=100*Math.cos(Math.PI/2-h*c),r=100*Math.cos(h*c);const u=new d(e,n+o,i-r,1);s=new Be(a,u,Oe.activeShape,t);break;case"out":o=100*Math.cos(Math.PI/2-h*l),r=100*Math.cos(h*l);const p=new d(e,n-o,i+r,1);s=new Be(a,Oe.activeShape,p,t)}return Te.addShape(a,s),Oe.activeShape.deactivate(),Oe.systemStateActivate("tr",s),Te.draw(),!1},rearrangement:()=>{let t=null;switch(Oe.activeShape.type){case"in":t=Oe.activeShape.target;break;case"out":t=Oe.activeShape.source}let e,a,s,n=0,i=0,o=0,r=0;const c=Math.PI/Pe;for([e,a]of Te.shMap)s=e.substring(0,1),"t"===s&&void 0!==a.type&&e!=Oe.activeShape.id&&(a.source===t?(o=100*Math.cos(Math.PI/2-c*i),r=100*Math.cos(c*i),i++,a.target.move(t.x-o,t.y+r)):a.target===t&&(o=100*Math.cos(Math.PI/2-c*n),r=100*Math.cos(c*n),n++,a.source.move(t.x+o,t.y-r)))},arrangement:(t=Oe.activeShape)=>{let e=null;switch(t.type){case"in":e=t.target;break;case"out":e=t.source}let a,s,n,i=0,o=0,r=0,c=0;const l=Math.PI/Pe;for([a,s]of Te.shMap)n=a.substring(0,1),"t"===n&&void 0!==s.type&&(s.source===e?(r=100*Math.cos(Math.PI/2-l*o),c=100*Math.cos(l*o),o++,s.target.move(e.x-r,e.y+c)):s.target===e&&(r=100*Math.cos(Math.PI/2-l*i),c=100*Math.cos(l*i),i++,s.source.move(e.x+r,e.y-c)))},arrangementstate:(t=Oe.activeShape)=>{let e,a,s,n=0,i=0,o=0,r=0;const c=Math.PI/Pe;for([e,a]of Te.shMap)s=e.substring(0,1),"t"===s&&void 0!==a.type&&("out"===a.type&&a.source===t?(o=100*Math.cos(Math.PI/2-c*i),r=100*Math.cos(c*i),i++,a.target.move(t.x-o,t.y+r)):"in"===a.type&&a.target===t&&(o=100*Math.cos(Math.PI/2-c*n),r=100*Math.cos(c*n),n++,a.source.move(t.x+o,t.y-r)))},limitspAoutreached:(t=Oe.activeShape)=>{let e,a,s,n=0;for([e,a]of Te.shMap)s=e.substring(0,1),"t"===s&&"out"===a.type&&a.source===t&&n++;return n>=Pe},limitspAinreached:(t=Oe.activeShape)=>{let e,a,s,n=0;for([e,a]of Te.shMap)s=e.substring(0,1),"t"===s&&"in"===a.type&&a.target===t&&n++;return n>=Pe},init:(t,e,a)=>{Te=t,Oe=e,Pe=a}};var Xe=Le;var je=class extends d{constructor(t,e,a,s,n){super(t,e,a),this.type=s,this.max=n}draw(){const t=l.context;t.lineWidth=this.lineWidth,t.strokeStyle=this.colour,t.fillStyle=this.colour,t.font="20px Verdana, Geneva, Tahoma, sans-serif",t.textAlign="center",t.textBaseline="middle",t.strokeRect(this.x-15,this.y-15,this.radius+10,this.radius+10),t.fillText(this.name,this.x,this.y)}};let Ke={},He={},Ge={},Ve=0;const Ne={specialstatecreate:(t,e)=>{const a=Ke.generateFreeID("s");if(0===a.length)return alert("Only "+Ve+" states allowed, limit reached!"),!1;var s="100";if(null===s)return;var n=Math.floor(Number(s));if(!(n!==1/0&&String(n)===s&&n>=0))return void alert("Error with the input!\nThe capacity must be a number less or equal zero.");s=parseInt(s);const i=new je(a,t.offsetX,t.offsetY,e,s);if(Ke.stateconflict(i))return alert("Collision with another State"),!1;Ke.addShape(a,i),He.systemStateActivate("sr",i),Ke.draw();const o=Ke.generateFreeID("s"),r=new d(o,t.offsetX-50,t.offsetY+150);r.capacitystate="left",r.lineWidth=2,Ke.addShape(o,r),Ke.draw();const c=Ke.generateFreeID("s"),l=new d(c,t.offsetX+50,t.offsetY+150);l.capacitystate="right",l.lineWidth=.5,Ke.addShape(c,l),Ke.draw();const u=Ke.generateFreeID("t"),h=new ct(u,Ke.getShape(a),Ke.getShape(o));h.capacitystate="left",h.lineWidth=2,Ke.addShape(u,h);const p=Ke.generateFreeID("t"),m=new ct(p,Ke.getShape(a),Ke.getShape(c));return m.capacitystate="right",m.lineWidth=.5,Ke.addShape(p,m),Ke.draw(),!1},specialstatechangemax:()=>{var t=window.prompt("Insert the capacity of the state:",100);if(null!==t){var e=Math.floor(Number(t));e!==1/0&&String(e)===t&&e>=0?(t=parseInt(t),He.activeShape.max=t):alert("Error with the input!\nThe capacity must be a number less or equal zero.")}},returncapacitytransitionsbystate:t=>{let e,a,s=[];for([e,a]of Ke.shMap)"t"===e.substring(0,1)&&a.source===t&&null!=a.capacitystate&&s.push(a);return s},returncapacitytransitionsbytransition:t=>{let e,a,s=[],n=t.target;for([e,a]of Ke.shMap)"t"===e.substring(0,1)&&a.source===n&&null!=a.capacitystate&&s.push(a);return s},returncapacitystatesbystate:t=>{let e,a,s=[];for([e,a]of Ke.shMap)"t"===e.substring(0,1)&&a.source===t&&null!=a.capacitystate&&s.push(a.target);return s},inserttransitionlimitreached:t=>{let e,a,s=!1;for([e,a]of Ke.shMap)"t"===e.substring(0,1)&&a.target===t&&(s=!0);return s},init:(t,e,a,s)=>{Ke=t,He=e,Ge=a,Ve=s}};var Fe=Ne;const Ue={};Ue.help=n,Ue.symbols=c,Ue.alphabet="L",Ue.callback=gt.update,Ue.activeShape=null,Ue.selectionTransitionTarget=!1,Ue.selectionTransitionSource=!1,Ue.selectionTransitionFactor=!1,Ue.state="i",Ue.nameOld="",Ue.initState=()=>{let t="n",e=new d(t,0,0,0);tt.addShape(t,e);let a=78;e.nameAddChr(a),t=tt.generateFreeID("s"),e=new d(t,2*l.stateRadius,2*l.stateRadius),tt.addShape(t,e),a=Ue.symbols.L.C.S,e.nameAddChr(a)},Ue.init=()=>{l.canvas=document.getElementById("canvasID"),l.context=l.canvas.getContext("2d"),tt.init(l.canvas,l.stateRadius,l.hitTargetPadding,l.instancesLimit),ft.init(tt,Ue,l.instancesLimit,Xe,Fe),Xe.init(tt,Ue,l.specialArrowLimit),rt.init(tt,Ue,ft,Fe,l.instancesLimit),Fe.init(tt,Ue,ft,l.instancesLimit),Me.init(Ue,ft,rt,Xe,o),Ue.helpBox=document.getElementById("helpID"),Ue.helpBox.innerHTML=Ue.help.i,F(l.canvas,Ue,rt,Fe,ft,l.stateKeys,l.transitionKeys),Ue.initState(),tt.draw(),Ue.callback(tt.shMap)},Ue.systemStateActivate=(t,e)=>{null!=e&&e.activate(),Ue.nameOld=null!=e?e.name:"",Ue.activeShape=e,Ue.state=t,Ue.selectionTransitionFactor=!1,Ue.selectionTransitionSource=!1,Ue.selectionTransitionTarget=!1,Ue.alphabet="tr"===t?"G":"L",Ue.helpBox.innerHTML=Ue.help[t],Me.systemupdate(t)},Ue.systemStateMouseDown=(t,e)=>{const a=tt.findShape(t,e);let s="i";if(null!=a){s=a.id.substring(0,1)+"m",a.moveStart(t,e);let n=Xe.returnstates(a);if(0!==n.length)for(let a=0;a<n.length;a++)n[a].moveStart(t,e)}"i"!==Ue.state&&Ue.activeShape.deactivate(),Ue.systemStateActivate(s,a),tt.draw()},Ue.moveStop=()=>{if(Ue.state.length>1&&"m"===Ue.state.substring(1,2)){Ue.activeShape.moveStop();let t=Xe.returnstates(Ue.activeShape);if(0!==t.length)for(let e=0;e<t.length;e++)t[e].moveStop();Ue.systemStateActivate(Ue.state.substring(0,1),Ue.activeShape)}},Ue.moveObject=t=>{Ue.activeShape.move(t.offsetX,t.offsetY);let e=Xe.returnstates(Ue.activeShape);if(0!==e.length)for(let a=0;a<e.length;a++)e[a].move(t.offsetX,t.offsetY);for(let t=0;t<e.length;t++)if(e[t].y<2){Ue.moveStop(),Ue.activeShape.move(Ue.activeShape.x,102),e[t].move(e[t].x,2);for(let t=0;t<e.length;t++)e[t].moveStop();Xe.arrangementstate()}else if(e[t].x<Ue.activeShape.radius){Ue.moveStop(),Ue.activeShape.move(Ue.activeShape.radius+102,Ue.activeShape.y);for(let t=0;t<e.length;t++)e[t].moveStop();Xe.arrangementstate()}if(tt.stateconflict(Ue.activeShape)){if(Ue.moveStop(),0!==e.length)for(let t=0;t<e.length;t++)e[t].moveStop();let t=0,a=0,s=1;for(;tt.stateconflict(Ue.activeShape);){for(;t<=s&&tt.stateconflict(Ue.activeShape);t++)if(Ue.activeShape.move(Ue.activeShape.x+t,Ue.activeShape.y+a),0!==e.length)for(let s=0;s<e.length;s++)e[s].move(e[s].x+t,e[s].y+a);for(;a<=s&&tt.stateconflict(Ue.activeShape);a++)if(Ue.activeShape.move(Ue.activeShape.x+t,Ue.activeShape.y+a),0!==e.length)for(let s=0;s<e.length;s++)e[s].move(e[s].x+t,e[s].y+a);for(s++;t>=-s&&tt.stateconflict(Ue.activeShape);t--)if(Ue.activeShape.move(Ue.activeShape.x+t,Ue.activeShape.y+a),0!==e.length)for(let s=0;s<e.length;s++)e[s].move(e[s].x+t,e[s].y+a);for(;a>=-s&&tt.stateconflict(Ue.activeShape);a--)if(Ue.activeShape.move(Ue.activeShape.x+t,Ue.activeShape.y+a),0!==e.length)for(let s=0;s<e.length;s++)e[s].move(e[s].x+t,e[s].y+a);s++}}tt.draw()};var ze=Ue;const Ye={};let Je={},_e={},qe={},We={},Ze={};function Qe(t){const e=[],a=t.nameArr.length,s=t.source;let n,i,o,r=0;if(0===a)return e;for(e[0]=[],n=0;n<a;n+=1)[i,o]=t.nameArr[n],"o"===i?(e[r].push(["s",s]),r+=1,e[r]=[]):0!==o.radius?e[r].push([i,o]):e[r].push(["n",o]);return e[r].push(["s",s]),e}function ta(t){const e=[],a=t.nameArr.length;let s,n,i,o=0;if(0===a)return e;for(e[0]=[],s=0;s<a;s+=1)[n,i]=t.nameArr[s],"o"===n?(o+=1,e[o]=[]):0!==i.radius?e[o].push([n,i]):e[o].push(["n",i]);return e}function ea(t,e,a){let s;const n=e.length,i=_e.get(t);for(s=0;s<n;s+=1)i.push({sign:a,prod:e[s]})}function aa(t,e,a,s,n,i){let o,r,c,l;for([r,c]of s)"t"===r.substring(0,1)&&c.source===a.source&&"left"===c.capacitystate&&(l=c.target.id);i="right"===n?l:3;const d=e.length,u=_e.get(t),h=a.source;for([r,c]of s)"t"===r.substring(0,1)&&c.target===h&&(o=c.source);if(void 0!==o){e[0][1][1]=o;for(let t=0;t<d;t+=1)u.push({sign:i,prod:e[t]})}}Ye.odeBuild=t=>{let e,a,s;for([e,a]of(function(t){let e,a;for([e,a]of(_e=new Map,qe=[],We=new Map,Ze=new Map,t))if("t"===e.substring(0,1)&&"left"===a.capacitystate&&Ze.set(a.source.id,a.target.id),"s"===e.substring(0,1))if(void 0===a.max)_e.set(a,[]);else{let s,n;for([s,n]of(qe.push(a),t))"t"===s.substring(0,1)&&n.source===a&&void 0!==n.capacitystate&&We.set(n.target.id,e)}}(t),t))"t"===e.substring(0,1)&&(void 0===a.capacitystate?void 0!==a.type?(s=ta(a),"in"===a.type?ea(a.target,s,1):ea(a.source,s,-1)):void 0===a.target.max?(s=Qe(a),ea(a.source,s,-1),ea(a.target,s,1)):(s=Qe(a),ea(a.source,s,-1)):(s=Qe(a),aa(a.target,s,a,t,a.capacitystate,1)))},Ye.update=t=>{let e,a,s,n,i,o,r,c,l,d,u,h,p,m=0,f=0,b=[];const v=String.fromCodePoint(8339);for([n,i]of(Ye.odeBuild(t),e="<table>",_e))if("N"!==n.name){b.push(n.name),a="<tr><td align='right'>",a=n.nameArr.length>1?a+"("+n.name+")"+v:a+n.name+v,a+="</td>",a+="<td align='center'>=</td>",a+="<td align='left'><div class='odeEquation'>",o=i.length,p=!1;let g=!0;for(r=0;r<o;r+=1){if(f=0,s=i[r].sign<0?"–":p?"+":"",g&&"left"===n.capacitystate){let e,a;for([e,a]of(s+=String.fromCodePoint(119892),s+="(",t))"t"===e.substring(0,1)&&"left"===a.capacitystate&&a.target===n&&(s+=a.source.name);s+="-",s+=n.name,s+=")",g=!1}if(g&&"right"===n.capacitystate){let e,a,i,o;for([e,a]of(s+="(1-",s+=String.fromCodePoint(119892),s+="(",t))"t"===e.substring(0,1)&&"right"===a.capacitystate&&a.target===n&&(s+=a.source.name);for([i,o]of(s+="-",t))if("t"===i.substring(0,1)&&"right"===o.capacitystate&&o.target===n){let e,a;for([e,a]of t)"t"===e.substring(0,1)&&"left"===a.capacitystate&&a.source===o.source&&(s+=a.target.name)}s+="))",g=!1}for(c=i[r].prod,l=c.length,d=0;d<l;d+=1)[u,h]=c[d],"s"===u?(h=h.name,f++):h="n"===u?h.name:String.fromCodePoint(h),s+=h;if(f>1){switch(s+="N",s+=String.fromCodePoint(8315),f--,f){case 1:m=185;break;case 2:m=178;break;case 3:m=179;break;default:m=8304+f}s+=String.fromCodePoint(m)}a+=s,p=!0}p||(a+="0"),a+="</div></td></tr>",e+=a}a="<tr><td align='right'>N</td><td align='center'>=</td><td align='left'><div class='odeEquation'>";for(let t=0;t<b.length;t++)t>0&&(a+="+"),a+=b[t];a+="</div></td></tr>",e+=a,e+="</table>",Je.innerHTML=e},Ye.init=t=>{Je=t},Ye.getODEs=()=>_e,Ye.getcapacitystates=()=>qe,Ye.getlinktocapacitystate=()=>We,Ye.getlinktcstateleftstate=()=>Ze;var sa=Ye;var na=function(){const t={},e=sa.getODEs(),a=sa.getcapacitystates(),s=sa.getlinktocapacitystate(),n=sa.getlinktcstateleftstate();return t.states=function(t){const e=new Map;return t.forEach((t,a)=>{e.set(a.id,a.name)}),e}(e),t.rates=function(t){const e=new Set;return t.forEach(t=>{t.forEach(t=>{t.prod.forEach(t=>{"r"===t[0]&&e.add(String.fromCodePoint(t[1]))})})}),e}(e),t.equations=function(t){const e=new Map;return t.forEach((t,a)=>{const s=[];t.forEach(t=>{const e={};e.sign=t.sign,e.prod=[],t.prod.forEach(t=>{const a="r"===t[0]?[t[0],String.fromCodePoint(t[1])]:[t[0],t[1].id];e.prod.push(a)}),s.push(e)}),e.set(a.id,s)}),e}(e),t.capacitystates=function(t){const e=new Map;for(let a=0;a<t.length;a++)e.set(t[a].id,t[a].name);return e}(a),t.linktocapacitystate=s,t.linktcstateleftstate=n,t};const ia={init:()=>{sa.init(document.getElementById("odeID")),gt.addListener(sa.update),we.setAlphabetHandler(Me.letterIn),we.setStateKeyHandler(ft.nameAppendState),we.setSpecialKeyHandler("plus",ft.nameAppendPlus),we.setSpecialKeyHandler("del",Me.RemoveTolken),we.setSpecialKeyHandler("check",Me.check),we.setSpecialKeyHandler("L",Me.updateAlphabetL),we.setSpecialKeyHandler("G",Me.updateAlphabetG),we.setSpecialKeyHandler("S",Me.updateAlphabetS),we.setSpecialKeyHandler("up",Me.updateAlphabetup),we.setSpecialKeyHandler("low",Me.updateAlphabetlow),we.setSpecialKeyHandler("Del",Me.delete),we.setSpecialKeyHandler("R",Me.rename),we.setSpecialKeyHandler("T",Me.newTransition),we.setSpecialKeyHandler("X",Me.leaveX),we.setSpecialKeyHandler("target",Me.transitiontarget),we.setSpecialKeyHandler("source",Me.transitionsource),we.setSpecialKeyHandler("in",Me.arrowIn),we.setSpecialKeyHandler("out",Me.arrowOut),we.setSpecialKeyHandler("checkenter",Me.checkenter),we.setSpecialKeyHandler("Deleteenter",Me.Deleteenter),we.setSpecialKeyHandler("Renter",Me.Renter),we.setSpecialKeyHandler("inenter",Me.inenter),we.setSpecialKeyHandler("outenter",Me.outenter),we.setSpecialKeyHandler("Genter",Me.Genter),we.setSpecialKeyHandler("Lenter",Me.Lenter),we.setSpecialKeyHandler("Senter",Me.Senter),we.setSpecialKeyHandler("upenter",Me.upenter),we.setSpecialKeyHandler("lowenter",Me.lowenter),we.setSpecialKeyHandler("Tenter",Me.Tenter),we.setSpecialKeyHandler("Xenter",Me.Xenter),we.setSpecialKeyHandler("targetenter",Me.tagetenter),we.setSpecialKeyHandler("sourceenter",Me.sourceenter),we.init(document.getElementById("inID"),gt),ze.init()}};ia.getODEs=na;var oa=ia;const ra={};function ca(){const t=ra.board.create("point",[0,0],{needsRegularUpdate:!1,visible:!1}),e=ra.board.create("point",[1,0],{needsRegularUpdate:!1,visible:!1}),a=ra.board.create("axis",[t,e],{needsRegularUpdate:!1,name:"$t$",withLabel:!0,label:{position:"rt",offset:[-5,8]}});a.removeAllTicks();const s=ra.board.create("ticks",[a,1],{offset:[-10,-10],precision:5,minorTicks:0,drawLabels:!0,grid:!0,majorHeight:-1,strokeColor:"#ccc"});let n,i,o;s.ticksFunction=()=>n,ra.board.fullUpdate();let r=[];const c=ra.board.create("point",[0,0],{needsRegularUpdate:!1,visible:!1}),l=ra.board.create("point",[0,1],{needsRegularUpdate:!1,visible:!1}),d=ra.board.create("axis",[c,l],{needsRegularUpdate:!1,withLabel:!0,label:{position:"rt",offset:[-5,8]}});d.removeAllTicks();const u=ra.board.create("ticks",[d,1],{strokeColor:"#ccc",label:{offset:[10,0]},precision:8,minorTicks:0,drawLabels:!0,drawZero:!1,majorHeight:-1});u.ticksFunction=()=>i,ra.board.fullUpdate();const h=function(){o=ra.board.getBoundingBox();const t=10**Math.floor(Math.log10(.6*(o[2]-o[0])));n=(o[2]-o[0])/t>5?t:.5*t;const e=10**Math.floor(Math.log10(.6*(o[1]-o[3])));i=(o[1]-o[3])/e>5?e:.5*e,ra.board.fullUpdate()};h();const p=ra.board.create("point",[0,0],{visible:!1});ra.upperAxis=30,ra.lowerAxis=ra.board.canvasHeight-30,ra.board.on("boundingbox",()=>{console.time("Axis"),o=ra.board.getBoundingBox();const n=new JXG.Coords(JXG.COORDS_BY_USER,[0,p.Y()],ra.board).scrCoords[2],i=new JXG.Coords(JXG.COORDS_BY_USER,[0,p.X()],ra.board).scrCoords[1];var m;n<=10?(a.point1.setAttribute({frozen:!0}),a.point2.setAttribute({frozen:!0}),s.visProp.label.offset=[-10,-10]):n>ra.board.canvasHeight-10?(t.moveTo((m=ra.board.canvasHeight-10,r=new JXG.Coords(JXG.COORDS_BY_SCREEN,[0,m],ra.board),r.usrCoords),0),e.moveTo((t=>(r=new JXG.Coords(JXG.COORDS_BY_SCREEN,[ra.board.canvasWidth,t],ra.board),r.usrCoords))(ra.board.canvasHeight-10),0),a.point1.setAttribute({frozen:!0}),a.point2.setAttribute({frozen:!0}),s.visProp.label.offset=[-10,9]):(a.point1.setAttribute({frozen:!1}),a.point2.setAttribute({frozen:!1}),t.moveTo([0,ra.yPost(0)],0),e.moveTo([1,ra.yPost(0)],0),t.moveTo([0,0],0),e.moveTo([1,0],0),s.visProp.label.offset=[-10,-10]),i<10?(c.moveTo((t=>(r=new JXG.Coords(JXG.COORDS_BY_SCREEN,[t,ra.board.canvasHeight],ra.board),r.usrCoords))(10),0),l.moveTo((t=>(r=new JXG.Coords(JXG.COORDS_BY_SCREEN,[t,0],ra.board),r.usrCoords))(10),0),d.point1.setAttribute({frozen:!0}),d.point2.setAttribute({frozen:!0}),u.visProp.label.offset=[7,0]):i>ra.board.canvasWidth-10?(d.point1.setAttribute({frozen:!0}),d.point2.setAttribute({frozen:!0}),u.visProp.label.offset=[-28,0],u.visProp.label.align="right"):(d.point1.setAttribute({frozen:!1}),d.point2.setAttribute({frozen:!1}),c.moveTo([0,0],0),l.moveTo([0,1],0)),h(),console.timeEnd("Axis")}),ra.boardRestriction=!0,ra.yLogFunc=function(){console.time("yLog"),this.checked?(ra.board.setBoundingBox([-ra.tEnd.X()/10,.3,1.1*ra.tEnd.X(),-Math.log10(1/ra.eps)-1],!1),u.generateLabelText=(t,e)=>t.usrCoords[2]-e.usrCoords[2]<-Math.log10(1/ra.eps)?"":t.usrCoords[2]-e.usrCoords[2]<1-Math.log10(1/ra.eps)?"0":"$10^{"+Math.floor(t.usrCoords[2]-e.usrCoords[2])+"}$",ra.yPre=t=>t>Math.log10(ra.eps)?10**t:0,ra.yPost=t=>Math.abs(t)>ra.eps?Math.log10(Math.abs(t)):Math.log10(ra.eps),ra.move=t=>t>ra.eps?Math.log10(t):Math.log10(ra.eps),ra.boardRestriction=!1,ra.board.highlightInfobox=function(t,e,a){e<=-Math.log10(1/ra.eps)?ra.board.infobox.setText(" ("+t+",0)"):ra.board.infobox.setText(" ("+t+" , $"+(10**e*10**Math.ceil(-e-1)%1*10).toFixed(2)+"\\cdot 10^{"+Math.ceil(-e)+"}$)")}):(ra.board.setBoundingBox([-ra.tEnd.X()/10,1.2,1.1*ra.tEnd.X(),-.1],!1),u.generateLabelText=function(t,e){return t.usrCoords[2]-e.usrCoords[2]},ra.yPost=t=>t,ra.yPre=t=>t,ra.move=t=>t>Math.log10(ra.eps)?10**t:0,ra.boardRestriction=!0,ra.board.highlightInfobox=function(t,e,a){ra.board.infobox.setText("("+t+", "+e+")")}),ra.board.fullUpdate(),h(),console.timeEnd("yLog")},window.MathJax={tex:{inlineMath:[["$","$"],["\\(","\\)"]]},jax:["input/TeX","output/HTML-CSS"],svg:{fontCache:"global"},startup:{promise:new Promise((function(t,e){setTimeout(()=>t(1),100)}))}},(()=>{const t=document.createElement("script");t.src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js",t.async=!0,document.head.appendChild(t)})(),ra.promise=new Promise((t,e)=>{setTimeout(()=>t(1),100)}),ra.typeset=function(t){return window.MathJax.startup.promise=window.MathJax.startup.promise.then(()=>(t(),window.MathJax.typesetPromise())).catch(t=>console.log("Typeset failed: "+t.message)),window.MathJax.startup.promise},ra.eps=1e-12,ra.yPre=t=>t,ra.yPost=t=>t,ra.move=t=>t>Math.log10(ra.eps)?10**t:0,$("#plotID").mouseenter(()=>{ra.helpID=$("#helpID").html(),$("#helpID").html("Scroll to zoom in and out. Hold <b>SHIFT</b> to pan.<br>To change interventions either drag them or hold <b>SHIFT</b> and click to enter coordinates directly. <br>Press <b>+</b> button to add an intervention and press <b>&#8211</b> button to remove last intervention.Switch <b>Log</b> checkbox to switch y-axis to logarithmic scale.<br>Press any checkbox in the <b>legend</b> to hide corresponding function graph.<br>")}),$("#plotID").mouseleave(()=>{$("#helpID").html(ra.helpID)}),$("#ratesID").mouseenter(()=>{ra.helpID=$("#helpID").html(),$("#helpID").html("Values can be adjusted by either directly changing the numerical value or by scrolling/ dragging the graph .<br>Click on intervention tab to view corresponding rates .<br>")}),$("#ratesID").mouseleave(()=>{$("#helpID").html(ra.helpID)}),$("#statesID").mouseenter(()=>{ra.helpID=$("#helpID").html(),$("#helpID").html("Values can be adjusted by either directly changing the numerical value or by scrolling/ dragging the graph .<br>")}),$("#statesID").mouseleave(()=>{$("#helpID").html(ra.helpID)}),$("#GraphButtons").html('<span class = "sum-checkbox"><input type="checkbox" id="slidersum" ><label class="label" for="slidersum" ></label></span><span class = "usersum-checkbox"><input type="checkbox" id="usersum" ><label class="label" for="usersum" ></label></span><span float="right" class="slider-checkbox"><input type="checkbox" id="logY" ><label class="label" for="logY"></label><button class="button" id="button">+</button>&nbsp<button class="button" id="button2">&#8211</button>')}function la(){!function(){const t=ra.board.create("line",[[0,0],[1,0]],{visible:!1});ra.tEnd=ra.board.create("glider",[200,0,t],{name:"$t_{\\infty}$",color:"black"}),ra.board.setBoundingBox([-ra.tEnd.X()/10,1.2,1.1*ra.tEnd.X(),-.1],!1),ra.tEnd.on("up",(function(t){const e=this;ra.promise=ra.promise.then(()=>{if(t.shiftKey&&null==ra.input){const t=ra.board.getBoundingBox();ra.typeset(()=>{ra.input=ra.board.create("text",[(t[2]+t[0])/2.5,(t[1]+t[3])/2,'<div id="inputID"><p>Enter Value of $t_\\\\infty$</p><br><input type="float" id="xValue" required value='+e.X()+'><br><br><button class="button" id="Accept">Accept</button></div>'],{fixed:!0,highlight:!1})}).then(()=>{$("#Accept").click(()=>{e.moveTo([$("#xValue").val(),0]),ra.board.removeObject(ra.input),ra.input=null,ra.plotCurves(),ra.board.setBoundingBox([-ra.tEnd.X()/10,t[1],1.1*ra.tEnd.X(),t[3]],!1)})})}ra.plotCurves();const a=ra.board.getBoundingBox();return ra.board.setBoundingBox([-ra.tEnd.X()/10,a[1],1.1*ra.tEnd.X(),a[3]],!1),new Promise((function(t,e){setTimeout(()=>t(1),100)}))})}))}(),function(){function t(t){return t<=ra.eps?Math.log10(ra.eps):1===t?Math.log10(1+ra.eps):Math.log10(t)}function e(t){return t<=Math.log10(ra.eps)?0:10**t}function a(){let t=0;return Object.keys(ra.states).forEach(a=>{t+=e(ra.states[a].point.X())}),0===t&&(t=1),t}function s(){let t=0;for(var e in ra.data.states)t+=ra.data.states[e].value;return 0===t&&(t=1),t}ra.saveStates=()=>{ra.data.states={},Object.keys(ra.states).forEach(t=>{ra.data.states[t]={},ra.data.states[t].value=ra.states[t].getValue(),ra.data.states[t].name=ra.states[t].name})},ra.savecapacityStates=()=>{ra.data.capacitystates={},Object.keys(ra.capacitystates).forEach(t=>{ra.data.capacitystates[t]={},ra.data.capacitystates[t].value=ra.capacitystates[t].getValue(),ra.data.capacitystates[t].name=ra.capacitystates[t].name})},ra.saveInterventions=()=>{ra.data.interventions={},Object.keys(ra.interventions).forEach(t=>{ra.data.interventions[t]=ra.interventions[t].getValue()})},ra.saveRates=()=>{ra.data.rates={},Object.keys(ra.rates).forEach(t=>{ra.data.rates[t]={},Object.keys(ra.interventions).forEach(e=>{ra.data.rates[t][e]=ra.rates[t][e].getValue()})})},ra.save=()=>{ra.saveStates(),ra.savecapacityStates(),ra.saveRates(),ra.saveInterventions()},ra.loadStates=()=>{ra.statesMap={},ra.board.suspendUpdate(),Object.values(ra.states).forEach(t=>{ra.board.removeObject(t.plotPoint),JXG.JSXGraph.freeBoard(t.board)}),Object.values(ra.curves).forEach(t=>{ra.board.removeObject(t)}),ra.board.removeObject(ra.labels),ra.board.unsuspendUpdate(),ra.states={};for(let t=0;t<Object.keys(ra.data.states).length;t++)ra.statesMap[Object.keys(ra.data.states)[t]]=t;const n=ra.board.create("line",[()=>-1*ra.interventions.t0.getValue(),()=>1,()=>0],{visible:!1});$("#statesID").empty(),$("#statesID").append("<table>"),document.getElementById("statesID").style.display="block",Object.keys(ra.data.states).forEach(i=>{ra.states[i]={},ra.states[i].name=ra.data.states[i].name,$("#statesID").append('<tr><td><div class="stateName" >'+ra.states[i].name+'(0) = </div></td><td><div contenteditable="true" class="stateText"  id= "text'+i+'">'+(ra.data.states[i].value<ra.eps?(0).toExponential(3):ra.data.states[i].value.toExponential(3))+'</div></td><td><div class="stateBoard" tabindex="1" id= "board'+i+'"></div></td></tr>'),ra.states[i].board=JXG.JSXGraph.initBoard("board"+i,{axis:!1,maxboundingbox:[-1/0,1/0,1/0,-1/0],showCopyright:!1,showNavigation:!1,showInfobox:!1,highlight:!1,highlightInfobox:!1,pan:{enabled:!0,needshift:!1},zoom:{factorX:1.05,factorY:1,wheel:!0,needshift:!1,eps:.01}}),ra.states[i].point=ra.states[i].board.create("point",[t(ra.data.states[i].value),0],{name:ra.data.states[i].name,visible:!0,highlight:!1,highlightInfobox:!1,label:{offset:[0,-25]},color:ra.colors[ra.statesMap[i]],fixed:!0,showInfobox:!1}),ra.states[i].board.setBoundingBox([t(ra.data.states[i].value)-2,.1,t(ra.data.states[i].value)+2,-.1]),ra.states[i].point.setAttribute({frozen:!0}),ra.states[i].getValue=function(){return e(this.point.X())};const o=ra.states[i].board.create("axis",[[0,0],[1,0]]);o.removeAllTicks(),ra.states[i].board.create("ticks",[o,1],{drawLabels:!0,minorTicks:0,drawZero:!0,generateLabelText:(t,e)=>t.usrCoords[1]-e.usrCoords[1]<=-12?0:"$10^{"+1*Math.floor(t.usrCoords[1]-e.usrCoords[1])+"}$"}),ra.states[i].plotPoint=ra.board.create("glider",[0,e(ra.states[i].point.X())/s(),n],{color:ra.colors[ra.statesMap[i]],name:ra.data.states[i].name+"(0)",label:{autoPosition:!0,visible:!1},showInfobox:!1,highlight:!1,fixed:!0}),ra.states[i].board.on("boundingbox",()=>{const t=ra.states[i].board.getBoundingBox();ra.states[i].board.setBoundingBox([t[2]-4,.1,t[2],-.1]);ra.states[i].getValue()<=ra.eps?document.getElementById("text"+i).innerHTML=(0).toExponential(3):document.getElementById("text"+i).innerHTML=ra.states[i].getValue().toExponential(3),Object.keys(ra.states).forEach(t=>{ra.states[t].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,ra.yPost(e(ra.states[t].point.X())/a())])}),ra.plotCurves()}),$(document).focusout("#text"+i,()=>{"block"===$("#statesID").css("display")&&(Object.keys(ra.states).forEach(t=>{ra.states[t].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,ra.yPost(parseFloat($("#text"+t).text())/a())])}),ra.states[i].board.setBoundingBox([t(parseFloat($("#text"+i).text()))-2,.1,t(parseFloat($("#text"+i).text()))+2,-.1]))})}),$("#statesID").append("</table>"),document.getElementById("statesID").style.display="none",ra.curves={},Object.keys(ra.data.states).forEach(t=>{ra.curves[t]=ra.board.create("curve",[0,0],{strokeColor:ra.colors[ra.statesMap[t]],name:ra.data.states[t].name+"(t)",highlight:!1}),ra.curves.n=ra.board.create("curve",[0,0],{strokeColor:"black",name:"N(t)",highlight:!1})}),ra.setLegend(),ra.setLegendFunction()},ra.loadcstates=()=>{if(ra.capacitystatesMap={},ra.board.suspendUpdate(),Object.values(ra.capacitystates).forEach(t=>{ra.board.removeObject(t.plotPoint),ra.board.removeObject(t.capacityline.point1),ra.board.removeObject(t.capacityline.point2),ra.board.removeObject(t.capacityline),JXG.JSXGraph.freeBoard(t.board)}),ra.board.removeObject(ra.labels),ra.board.unsuspendUpdate(),ra.capacitystates={},void 0!==ra.data.capacitystates)for(let t=0;t<Object.keys(ra.data.capacitystates).length;t++)ra.capacitystatesMap[Object.keys(ra.data.capacitystates)[t]]=t;const n=ra.board.create("line",[()=>-1*ra.interventions.t0.getValue(),()=>1,()=>0],{visible:!1});if($("#cstatesID").empty(),$("#cstatesID").append("<table>"),document.getElementById("cstatesID").style.display="block",void 0!==ra.data.capacitystates&&Object.keys(ra.data.capacitystates).forEach(i=>{ra.capacitystates[i]={},ra.capacitystates[i].name=ra.data.capacitystates[i].name,$("#cstatesID").append('<tr><td><div class="stateName" >'+ra.capacitystates[i].name+' = </div></td><td><div contenteditable="true" class="stateText"  id= "text'+i+'">'+(ra.data.capacitystates[i].value<ra.eps?(0).toExponential(3):ra.data.capacitystates[i].value.toExponential(3))+'</div></td><td><div class="stateBoard" tabindex="1" id= "board'+i+'"></div></td></tr>'),ra.capacitystates[i].board=JXG.JSXGraph.initBoard("board"+i,{axis:!1,maxboundingbox:[-1/0,1/0,1/0,-1/0],showCopyright:!1,showNavigation:!1,showInfobox:!1,highlight:!1,highlightInfobox:!1,pan:{enabled:!0,needshift:!1},zoom:{factorX:1.05,factorY:1,wheel:!0,needshift:!1,eps:.01}}),ra.capacitystates[i].point=ra.capacitystates[i].board.create("point",[t(ra.data.capacitystates[i].value),0],{name:ra.data.capacitystates[i].name,visible:!0,highlight:!1,highlightInfobox:!1,label:{offset:[0,-25]},color:ra.capacitycolors[ra.capacitystatesMap[i]],fixed:!0,showInfobox:!1}),ra.capacitystates[i].board.setBoundingBox([t(ra.data.capacitystates[i].value)-2,.1,t(ra.data.capacitystates[i].value)+2,-.1]),ra.capacitystates[i].point.setAttribute({frozen:!0}),ra.capacitystates[i].getValue=function(){return e(this.point.X())};const o=ra.capacitystates[i].board.create("axis",[[0,0],[1,0]]);o.removeAllTicks(),ra.capacitystates[i].board.create("ticks",[o,1],{drawLabels:!0,minorTicks:0,drawZero:!0,generateLabelText:(t,e)=>t.usrCoords[1]-e.usrCoords[1]<=-12?0:"$10^{"+1*Math.floor(t.usrCoords[1]-e.usrCoords[1])+"}$"}),ra.capacitystates[i].plotPoint=ra.board.create("glider",[0,e(ra.capacitystates[i].point.X())/s(),n],{color:ra.capacitycolors[ra.capacitystatesMap[i]],name:ra.data.capacitystates[i].name+"(0)",label:{autoPosition:!0,visible:!1},showInfobox:!1,highlight:!1,fixed:!0,size:2}),ra.capacitystates[i].capacityline=ra.board.create("line",[[ra.interventions.t0.getValue(),e(ra.capacitystates[i].point.X())/s()],[ra.tEnd.X(),e(ra.capacitystates[i].point.X())/s()]],{straightFirst:!1,straightLast:!1,strokeWidth:.5,color:ra.capacitycolors[ra.capacitystatesMap[i]],dash:4,highlight:!1}),ra.capacitystates[i].board.on("boundingbox",()=>{const t=ra.capacitystates[i].board.getBoundingBox();ra.capacitystates[i].board.setBoundingBox([t[2]-4,.1,t[2],-.1]);ra.capacitystates[i].getValue()<=ra.eps?document.getElementById("text"+i).innerHTML=(0).toExponential(3):document.getElementById("text"+i).innerHTML=ra.capacitystates[i].getValue().toExponential(3),Object.keys(ra.capacitystates).forEach(t=>{ra.capacitystates[t].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,ra.yPost(e(ra.capacitystates[t].point.X())/a())]),ra.capacitystates[t].capacityline.point1.setPositionDirectly(JXG.COORDS_BY_USER,[ra.interventions.t0.getValue(),ra.yPost(e(ra.capacitystates[t].point.X())/a())]),ra.capacitystates[t].capacityline.point2.setPositionDirectly(JXG.COORDS_BY_USER,[ra.tEnd.X(),ra.yPost(e(ra.capacitystates[t].point.X())/a())])}),ra.plotCurves()}),$(document).focusout("#text"+i,()=>{"block"===$("#cstatesID").css("display")&&(Object.keys(ra.capacitystates).forEach(t=>{ra.capacitystates[t].plotPoint.setPositionDirectly(JXG.COORDS_BY_USER,[0,ra.yPost(parseFloat($("#text"+t).text())/a())]),ra.capacitystates[t].capacityline.point1.setPositionDirectly(JXG.COORDS_BY_USER,[ra.interventions.t0.getValue(),ra.yPost(parseFloat($("#text"+t).text())/a())]),ra.capacitystates[t].capacityline.point2.setPositionDirectly(JXG.COORDS_BY_USER,[ra.tEnd.X(),ra.yPost(parseFloat($("#text"+t).text())/a())])}),ra.capacitystates[i].board.setBoundingBox([t(parseFloat($("#text"+i).text()))-2,.1,t(parseFloat($("#text"+i).text()))+2,-.1]))})}),$("#cstatesID").append("</table>"),document.getElementById("cstatesID").style.display="none",ra.setLegend(),ra.setLegendFunction(),0!==Object.keys(ra.capacitystates).length){let t="",e=!0;Object.keys(ra.capacitystates).forEach(a=>{void 0===ra.selectedfunction[a]&&(ra.capacityfunction[ra.linktcstateleftstate[a]]=function(t,e){return 1-Math.exp(-t*t*1/e)},ra.selectedfunction[a]=[],ra.selectedfunction[a].expfct=!0,ra.selectedfunction[a].sqrfct=!1,ra.selectedfunction[a].arctanfct=!1),t+="<option value =",t+=a,e&&(t+=" selected",e=!1),t+=">",t+=ra.capacitystates[a].name,t+="</option>"}),$("#cstatesID").append('<div style="font-family:\'Arial\'; font-size:15px">Choose the fitting function for the state:<select id="cselect">'+t+'</select> </div><div><input type="checkbox" id="expfct" checked><label for="expfct" style="font-family:\'Arial\'; font-size:15px; margin-right: 6px;">Exp</label><input type="checkbox" id="sqrfct"><label for="sqrfct" style="font-family:\'Arial\'; font-size:15px; margin-right: 6px;">Sqr</label><input type="checkbox" id="arctanfct"><label for="arctanfct" style="font-family:\'Arial\'; font-size:15px; margin-right: 6px;">Arctan</label></div>'),document.getElementById("expfct").addEventListener("click",(function(){document.getElementById("expfct").checked=!0,document.getElementById("sqrfct").checked=!1,document.getElementById("arctanfct").checked=!1,ra.selectedfunction[document.getElementById("cselect").value].expfct=!0,ra.selectedfunction[document.getElementById("cselect").value].sqrfct=!1,ra.selectedfunction[document.getElementById("cselect").value].arctanfct=!1,ra.capacityfunction[ra.linktcstateleftstate[document.getElementById("cselect").value]]=function(t,e){return 1-Math.exp(-t*t*1/e)},ra.plotCurves()})),document.getElementById("sqrfct").addEventListener("click",(function(){document.getElementById("expfct").checked=!1,document.getElementById("sqrfct").checked=!0,document.getElementById("arctanfct").checked=!1,ra.selectedfunction[document.getElementById("cselect").value].expfct=!1,ra.selectedfunction[document.getElementById("cselect").value].sqrfct=!0,ra.selectedfunction[document.getElementById("cselect").value].arctanfct=!1,ra.capacityfunction[ra.linktcstateleftstate[document.getElementById("cselect").value]]=function(t,e){return 1-1/Math.sqrt(1+t*t*1/e)},ra.plotCurves()})),document.getElementById("arctanfct").addEventListener("click",(function(){document.getElementById("expfct").checked=!1,document.getElementById("sqrfct").checked=!1,document.getElementById("arctanfct").checked=!0,ra.selectedfunction[document.getElementById("cselect").value].expfct=!1,ra.selectedfunction[document.getElementById("cselect").value].sqrfct=!1,ra.selectedfunction[document.getElementById("cselect").value].arctanfct=!0,ra.capacityfunction[ra.linktcstateleftstate[document.getElementById("cselect").value]]=function(t,e){return 1-1/(1+Math.atan(t)*Math.atan(t))},ra.plotCurves()})),document.getElementById("cselect").addEventListener("change",(function(){let t;for(t in ra.selectedfunction[document.getElementById("cselect").value])document.getElementById(t).checked=ra.selectedfunction[document.getElementById("cselect").value][t]})),Object.keys(ra.capacitystates).forEach(t=>{let e;for(e in ra.selectedfunction[t])ra.selectedfunction[t][e]&&(document.getElementById("cselect").value=t,document.getElementById(e).click())})}},ra.loadInterventions=()=>{ra.board.suspendUpdate(),Object.values(ra.interventions).forEach(t=>{ra.board.removeObject(t.line.point1),ra.board.removeObject(t.line.point2),ra.board.removeObject(t.line),ra.board.removeObject(t.point)}),ra.board.unsuspendUpdate(),ra.board.update(),ra.interventions={};const e=ra.board.create("line",[[0,0],[1,0]],{visible:!1});$("#tabtab3ID").empty(),Object.keys(ra.data.interventions).forEach(a=>{ra.interventions[a]={},ra.interventions[a].point=ra.board.create("glider",[ra.data.interventions[a],0,e],{color:"black",visible:!0,name:"$t_{"+a.substring(1)+"}$"}),ra.interventions[a].line=ra.board.create("line",[[()=>ra.interventions[a].point.X(),0],[()=>ra.interventions[a].point.X(),1]],{color:"lightGrey",visible:!0}),ra.interventions[a].point.on("up",(function(t){const e=this;ra.promise=ra.promise.then(()=>{if(t.shiftKey&&null==ra.input){const t=ra.board.getBoundingBox();ra.typeset(()=>{ra.input=ra.board.create("text",[(t[2]+t[0])/2.5,(t[1]+t[3])/2,'<div id="inputID"><p>Enter Value of $t$<sub>'+a.substring(1,2)+'</sub></p><br><input type="float" id="xValue" required value='+e.X()+'><br><br><button class="button" id="Accept">Accept</button></div>'],{fixed:!0,highlight:!1})}).then(()=>{$("#Accept").click(()=>{e.moveTo([$("#xValue").val(),0]),ra.board.removeObject(ra.input),ra.input=null,ra.plotCurves()})})}return ra.plotCurves(),new Promise((function(t,e){setTimeout(()=>t(1),100)}))})})),ra.interventions[a].getValue=function(){return this.point.X()},$("#tabtab3ID").append('<button id = "button'+a+'">t<sub>'+a.substring(1)+"</sub></button>"),$("#button"+a).click(()=>{ra.activeIntervention=a,$("#tabtab3ID").children().removeClass("active"),$("#button"+a).addClass("active"),Object.keys(ra.rates).forEach(e=>{Object.keys(ra.interventions).forEach(t=>{ra.rates[e][t].point.setAttribute({visible:!1,frozen:!1})}),ra.rates[e].board.setBoundingBox([t(ra.rates[e][a].getValue())-2,.1,t(ra.rates[e][a].getValue())+2,-.1]),ra.rates[e][a].point.setAttribute({visible:!0,frozen:!0})})})}),ra.interventions.t0.line.setAttribute({visible:!1}),$("#buttont0").addClass("active"),ra.activeIntervention="t0"},ra.loadRates=()=>{ra.rates={},$("#ratesID").empty(),$("#ratesID").append("<table>"),document.getElementById("ratesID").style.display="block",Object.keys(ra.data.rates).forEach(a=>{ra.rates[a]={},$("#ratesID").append('<tr><td><div class="rateName" >'+a+'= </div></td><td><div contenteditable="true" class="rateText"  id= "text'+a+'">'+ra.data.rates[a].t0+'</div></td><td><div class="rateBoard"  id= "board'+a+'"></div></td></tr>'),ra.rates[a].board=JXG.JSXGraph.initBoard("board"+a,{axis:!1,maxboundingbox:[-1/0,1/0,1/0,-1/0],boundingbox:[-.6,.1,1,-.1],showCopyright:!1,showNavigation:!1,showInfobox:!1,highlight:!1,pan:{enabled:!0,needshift:!1},zoom:{factorX:1.05,factorY:1,wheel:!0,needshift:!1,eps:.01}});const s=ra.rates[a].board.create("axis",[[0,0],[1,0]]);s.removeAllTicks(),ra.rates[a].board.create("ticks",[s,1],{drawLabels:!0,minorTicks:0,drawZero:!0,generateLabelText:(t,e)=>t.usrCoords[1]-e.usrCoords[1]<=-12?0:"$10^{"+1*Math.floor(t.usrCoords[1]-e.usrCoords[1])+"}$"}),Object.keys(ra.data.rates[a]).forEach(s=>{ra.rates[a][s]={},ra.rates[a][s].point=ra.rates[a].board.create("point",[t(ra.data.rates[a][s]),0],{name:a,visible:!1,label:{offset:[0,-25]},color:"black",fixed:!0,showInfobox:!1,highlight:!1}),ra.rates[a][s].getValue=function(){return e(this.point.X())},ra.rates[a].board.on("boundingbox",()=>{const t=ra.rates[a].board.getBoundingBox();ra.rates[a].board.setBoundingBox([t[2]-4,.1,t[2],-.1]);ra.rates[a][ra.activeIntervention].getValue()<=ra.eps?document.getElementById("text"+a).innerHTML=(0).toExponential(3):document.getElementById("text"+a).innerHTML=ra.rates[a][ra.activeIntervention].getValue().toExponential(3),ra.plotCurves()}),$(document).focusout("#text"+a,()=>{"block"===$("#ratesID").css("display")&&ra.rates[a].board.setBoundingBox([t(parseFloat($("#text"+a).text()))-2,.1,t(parseFloat($("#text"+a).text()))+2,-.1])})})}),$("#ratesID").append("</table>"),Object.keys(ra.data.rates).forEach(e=>{ra.rates[e].board.setBoundingBox([t(ra.data.rates[e].t0)-2,.1,t(ra.data.rates[e].t0)+2,-.1]),ra.rates[e].t0.point.setAttribute({visible:!0,frozen:!0})})}}(),ra.data.states={},ra.data.states.s0={},ra.data.states.s0.name="S",ra.data.states.s0.value=1e3,ra.data.interventions={},ra.data.interventions.t0=0,ra.data.rates={},ra.load()}ra.curves={},ra.data={},ra.states={},ra.capacitystates={},ra.linktocapacitystate={},ra.linktcstateleftstate={},ra.capacityfunction={},ra.selectedfunction={},ra.rates={},ra.statesMap={},ra.capacitystatesMap={},ra.interventions={},ra.load=()=>{$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),$("#cstatesID").hide(),ra.loadInterventions(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#cstatesID").show(),ra.loadStates(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#cstatesID").show(),ra.loadcstates(),$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),$("#cstatesID").hide(),ra.loadRates(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#cstatesID").show(),$("#Values").addClass("active"),$("#Rates").removeClass("active")},ra.update=()=>{ra.save();const t=oa.getODEs();t.states.forEach((t,e)=>{Object.keys(ra.data.states).includes(e)?ra.data.states[e].name!==t&&(ra.data.states[e].name=t):(ra.data.states[e]={},ra.data.states[e].name=t,ra.data.states[e].value=0)}),Object.keys(ra.data.states).forEach(e=>{t.states.has(e)||delete ra.data.states[e]}),t.rates.forEach(t=>{Object.keys(ra.data.rates).includes(t)||(ra.data.rates[t]={},Object.keys(ra.data.interventions).forEach(e=>{ra.data.rates[t][e]=.1}))}),Object.keys(ra.data.rates).forEach(e=>{t.rates.has(e)||delete ra.data.rates[e]}),t.capacitystates.forEach((t,e)=>{Object.keys(ra.data.capacitystates).includes(e)?ra.data.capacitystates[e].name!==t&&(ra.data.capacitystates[e].name=t):(ra.data.capacitystates[e]={},ra.data.capacitystates[e].name=t,ra.data.capacitystates[e].value=100)}),t.linktocapacitystate.forEach((t,e)=>{ra.linktocapacitystate[e]=t}),t.linktcstateleftstate.forEach((t,e)=>{ra.linktcstateleftstate[e]=t}),Object.keys(ra.data.capacitystates).forEach(e=>{t.capacitystates.has(e)||delete ra.data.capacitystates[e]}),ra.load(),ra.plotCurves()},ra.pointArray=[],ra.interventionArray=[],ra.colors=["red","blue","green","purple","orange","gray","pink","yellow","teal","Brown","BlueViolet","CadetBlue","Chartreuse","Chocolate","CornflowerBlue","Coral","Crimson","Cyan","DarkMagenta","DarkGreen"],ra.capacitycolors=["Fuchsia","Lime","Indigo","Khaki","Magenta","Maroon","Navy","Olive"],ra.setLegend=()=>{let t="",e="<br>";t+=" .switch { position: relative; display: inline-block; width: 30px; height: 18px;}",t+=".switch input {opacity: 0;width: 0;height: 0;}",t+=".slidern {position: absolute; cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #ccc;-webkit-transition: 0.4s;transition: 0.4s;}",t+='.slidern:before {position: absolute;content: ""; height: 13px; width: 13px; left: 2px;bottom: 2px; background-color: white;-webkit-transition: 0.4s;transition: 0.4s;}',t+="input:checked + .slidern {background-color:",t+="black",t+=";}",t+="input:focus + .slidern {box-shadow: 0 0 1px grey;}",t+="input:checked + .slidern:before {-webkit-transform: translateX(13px); -ms-transform: translateX(13px); transform: translateX(13px);}",t+=".slidern.round {border-radius: 17px;}",t+=".slidern.round:before {border-radius: 50%;}",e+='<label class="switch">',e+='<input type="checkbox" id="checkn" name="checkn" checked> n',e+='<span class="slidern round"></span></label><span> ',e+="N",e+="(t)  &nbsp&nbsp</span><br>",Object.keys(ra.curves).forEach(a=>{"n"!==a&&(t+=".slider"+a+" {position: absolute; cursor: pointer;top: 0;left: 0;right: 0;bottom: 0;background-color: #ccc;-webkit-transition: 0.4s;transition: 0.4s;}",t+=".slider"+a+':before {position: absolute;content: ""; height: 13px; width: 13px; left: 2px;bottom: 2px; background-color: white;-webkit-transition: 0.4s;transition: 0.4s;}',t+="input:checked + .slider"+a+" {background-color:",t+="n"===a?"black":ra.colors[ra.statesMap[a]],t+=";}",t+="input:focus + .slider"+a+" {box-shadow: 0 0 1px "+ra.colors[ra.statesMap[a]]+";}",t+="input:checked + .slider"+a+":before {-webkit-transform: translateX(13px); -ms-transform: translateX(13px); transform: translateX(13px);}",t+=".slider"+a+".round {border-radius: 17px;}",t+=".slider"+a+".round:before {border-radius: 50%;}",e+='<label class="switch">',e+='<input type="checkbox" id="check'+a+'" name="check'+a+'" checked> '+a,e+='<span class="slider'+a+' round"></span></label><span> ',e+="n"===a?"N":ra.states[a].name,e+="(t)  &nbsp&nbsp</span><br>")});const a=document.createElement("style");a.type="text/css",a.innerHTML=t,document.getElementsByTagName("head")[0].appendChild(a);const s=ra.board.getBoundingBox();ra.labels=ra.board.create("text",[s[2],(s[1]+s[3])*(.55+.03*Object.keys(ra.curves).length),e],{frozen:!0,fontSize:18,fixed:!0,visible:!0,anchorX:"right",anchorY:"top",highlight:!1})},ra.setLegendFunction=()=>{Object.keys(ra.curves).forEach(t=>{$("#check"+t).on("click",(function(){this.checked?ra.curves[t].setAttribute({visible:!0}):ra.curves[t].setAttribute({visible:!1})}))})};const da={};function ua(t){document.getElementById("usersum").checked&&t&&function(){const t=ra.board.getBoundingBox();let e=0,a=ra.board.create("text",[(t[2]+t[0])/2.5,(t[1]+t[3])/2,'<div id = "usersuminput"><p>How many sumcurves should be plotted?</p><br><input type ="number" id="sumvalue" value="1" min="1"><br><br><button id="usersuminputaccept">Accept</button>&nbsp&nbsp<button id="usersuminputcancel">Cancel</button></div>'],{fixed:!0,highlight:!1});document.getElementById("usersuminputaccept").addEventListener("click",(function(){e=document.getElementById("sumvalue").value,ra.board.removeObject(a),function(t){let e='<div id="sumcurveselect">',a='<option value = "none">"None"</option>';Object.keys(ra.states).forEach(t=>{a+="<option value =",a+=t,a+=">",a+=ra.states[t].name,a+="</option>"});for(let s=0;s<t;s++)e+='<div id="select',e+=s,e+='"><p>Sum ',e+=s,e+="</p>",Object.keys(ra.states).forEach(t=>{e+='<select id="',e+=s,e+=t,e+='">',e+=a,e+="</select>"}),e+="</div>",e+="<br>";e+='<button id="usersuminputaccept2">Accept</button>&nbsp&nbsp<button id="usersuminputcancel2">Cancel</button>',e+="</div>";const s=ra.board.getBoundingBox();let n=ra.board.create("text",[(s[2]+s[0])/2.5,(s[1]+s[3])/2,e],{fixed:!0,highlight:!1});document.getElementById("usersuminputaccept2").addEventListener("click",(function(){da.userarray=[];for(let e=0;e<t;e++){let t=[],a="select"+e,s=document.getElementById(a).querySelectorAll("select");for(let e=0;e<s.length;e++){let a=s[e];"none"!==a.value&&t.push(a.value)}da.userarray.push(t)}ra.board.removeObject(n),ha(da.userarray,!0)})),document.getElementById("usersuminputcancel2").addEventListener("click",(function(){ra.board.removeObject(n),document.getElementById("usersum").checked=!1}))}(e)})),document.getElementById("usersuminputcancel").addEventListener("click",(function(){ra.board.removeObject(a),document.getElementById("usersum").checked=!1}))}(),document.getElementById("usersum").checked&&!t&&ha(da.userarray,!1),!document.getElementById("usersum").checked&&t&&(Object.values(da.usercurves).forEach(t=>{ra.board.removeObject(t)}),da.usercurves=[],da.userarray=[],Object.keys(ra.data.states).forEach(t=>{ra.curves[t].showElement(),document.getElementById("check"+t).checked=!0}))}function ha(t,e){Object.values(da.usercurves).forEach(t=>{ra.board.removeObject(t)});for(let a=0;a<t.length;a++){let s=new Array(ra.curves.n.dataY.length).fill(0);for(let n=0;n<t[a].length;n++){e&&(ra.curves[t[a][n]].hideElement(),document.getElementById("check"+t[a][n]).checked=!1);for(let e=0;e<s.length;e++)s[e]+=ra.curves[t[a][n]].dataY[e]}let n=t[a][0]+"sum"+a;da.usercurves[n]=ra.board.create("curve",[ra.curves.n.dataX,s],{strokeColor:ra.colors[ra.statesMap[t[a][0]]],name:n+"(t)",strokeWidth:2,highlight:!1})}}function pa(){$("#button").click(()=>{console.time("addIntervention"),ra.save(),ra.data.interventions["t"+Object.keys(ra.data.interventions).length]=ra.data.interventions["t"+(Object.keys(ra.data.interventions).length-1)]+10,Object.keys(ra.data.rates).forEach(t=>{ra.data.rates[t]["t"+Object.keys(ra.data.rates[t]).length]=ra.data.rates[t]["t"+(Object.keys(ra.data.rates[t]).length-1)]}),ra.load(),console.timeEnd("addIntervention"),ra.plotCurves()}),$("#button2").click(()=>{console.time("removeIntervention"),ra.save(),Object.keys(ra.data.interventions).length>=2&&(delete ra.data.interventions["t"+(Object.keys(ra.data.interventions).length-1)],Object.keys(ra.data.rates).forEach(t=>{delete ra.data.rates[t]["t"+Object.keys(ra.data.interventions).length]})),ra.load(),console.timeEnd("removeIntervention"),ra.plotCurves()}),$("#slidersum").change(()=>{document.getElementById("slidersum").checked?da.visibility=!0:Object.keys(ra.data.states).forEach(t=>{ra.curves[t].showElement(),document.getElementById("check"+t).checked=!0}),ra.plotCurves()}),$("#usersum").change(()=>{ua(!0),ra.plotCurves()}),$("#logY").change((function(){ra.yLogFunc.call(this),Object.keys(ra.states).forEach(t=>{ra.states[t].plotPoint.moveTo([ra.states[t].plotPoint.X(),ra.move(ra.states[t].plotPoint.Y())])}),ra.plotCurves()}))}da.curves=[],da.number={8321:1,8322:2,8323:3,8324:4,8325:5,8326:6,8327:7,8328:8,8329:9},da.visibility=!1,da.usercurves=[],da.userarray=[];var ma=function(){pa()};var fa=function(){console.time("Ode");const t=oa.getODEs(),e={};function a(t){return Object.keys(ra.interventions).includes("t"+(1+parseInt(t.substring(1),10)))?ra.interventions["t"+(1+parseInt(t.substring(1),10))].getValue():ra.tEnd.X()}ra.delta=20,Object.keys(ra.interventions).forEach(a=>{e[a]=function(e){return function(a,s){const n=s.map(()=>0);let i,o=0;t.equations.forEach((t,e)=>{o+=s[ra.statesMap[e]]});var r=ra.capacityfunction;return t.equations.forEach((t,a)=>{t.forEach(t=>{i=!1;let c=t.sign>0?1:-1;1!==t.sign&&-1!==t.sign&&3!==t.sign?c=1-r[t.sign](ra.capacitystates[ra.linktocapacitystate[a]].getValue()-s[ra.statesMap[t.sign]],o):3===t.sign&&(c=r[a](ra.capacitystates[ra.linktocapacitystate[a]].getValue()-s[ra.statesMap[a]],o)),t.prod.forEach(t=>{"r"===t[0]?c*=ra.rates[t[1]][e].getValue():"n"===t[0]?c*=o:(i?(c*=s[ra.statesMap[t[1]]],c/=o):c*=s[ra.statesMap[t[1]]],i=!0)}),n[ra.statesMap[a]]+=c})}),n}}(a)});let s=[[]];t.states.forEach((t,e)=>{s[0][ra.statesMap[e]]=ra.states[e].getValue()}),Object.keys(ra.interventions).sort((t,e)=>t.substring(1)<e.substring(1)?-1:1).forEach(t=>{s=s.concat(JXG.Math.Numerics.rungeKutta("rk4",s[s.length-1],[ra.interventions[t].getValue(),a(t)],(a(t)-ra.interventions[t].getValue())*ra.delta+1,e[t]).slice(1))});let n=0;for(let t=0;t<s[0].length;t++)n+=s[0][t];if(0!==n)for(let t=0;t<s.length;t++)for(let e=0;e<s[t].length;e++)s[t][e]=s[t][e]/n;for(let t=0;t<s.length;t++){let e=0;s[t][s[s.length-1].length]=ra.interventions.t0.getValue()+t/ra.delta;for(let a=0;a<s[t].length-1;a++)e+=s[t][a];s[t].unshift(e)}return console.timeEnd("Ode"),s};var ba=function(){ra.plotCurves=function(t,e){let a=-1;return function(){clearTimeout(a);const s=arguments,n=this;a=setTimeout((function(){t.apply(n,s)}),e)}}(()=>{const t=fa();console.time("Plot"),Object.keys(ra.curves).forEach(e=>{ra.curves[e].dataX=[],ra.curves[e].dataY=[];for(let a=0;a<1e3;a++)ra.curves[e].dataX[a]=t[Math.floor(a*t.length/1e3)][t[0].length-1],ra.curves[e].dataY[a]="n"===e?ra.yPost(t[Math.floor(a*t.length/1e3)][0]):ra.yPost(t[Math.floor(a*t.length/1e3)][ra.statesMap[e]+1])}),function(){if(Object.values(da.curves).forEach(t=>{ra.board.removeObject(t)}),!document.getElementById("slidersum").checked)return;let t=[],e=[],a=!1;Object.keys(ra.data.states).forEach(s=>{if(a=!1,!e.includes(s)&&(t=ra.curves[s].dataY.slice(),"n"!=s&&(Object.keys(ra.data.states).forEach(n=>{if("n"!=n&&function(t,e){for(var a=0,s=0,n="";s<e.length;)t[a]!=e[s]||a==t.length?n+=e[s]:a++,s++;return n}(ra.states[s].name,ra.states[n].name).charCodeAt(0)in da.number){da.visibility&&(ra.curves[n].hideElement(),document.getElementById("check"+n).checked=!1),e.push(n),a=!0;for(let e=0;e<t.length;e++)t[e]+=ra.curves[n].dataY[e]}}),a))){da.visibility&&(ra.curves[s].hideElement(),document.getElementById("check"+s).checked=!1);let e=s+"sum";da.curves[e]=ra.board.create("curve",[ra.curves.n.dataX,t],{strokeColor:ra.colors[ra.statesMap[s]],name:e+"(t)",strokeWidth:2,highlight:!1})}}),da.visibility=!1,ra.board.update()}(),ua(!1),ra.board.update(),console.timeEnd("Plot")},20)};const va={};function ga(t){var e,a,s,n,i,o,r=0,c="s1",l=!0,u="",h="";if("Epidemic-Model-Data"===t.slice(0,19)){for(r=20;":"!==t[r];){for(s=[],e=0,a=0,n="",i="",o="",u="";"("!==t[r];){switch(t[r]){case"m":r+=10,u="m";break;case"l":r+=10,u="l";break;case"r":r+=11,u="r"}i+=t[r],r++}for(r++;","!==t[r];)e+=t[r],r++;for(e=parseInt(e),r++;")"!==t[r];)a+=t[r],r++;for(a=parseInt(a),r++,r++;","!==t[r];)o+=t[r],r++;for(o=parseFloat(o),r++;";"!==t[r]&&":"!==t[r];)n+=t[r],","===t[++r]&&(s.push(parseInt(n)),n="",r++);if(s.push(parseInt(n)),l){var p=0;l=!1;const t=tt.getShape("s0");for(ze.systemStateActivate("sr",t),ze.activeShape.move(e,a),rt.nameRemoveToken();p<s.length;)rt.stateName(s[p]),p++;ze.activeShape.deactivate(),ze.systemStateActivate("i"),tt.draw(),ze.callback(tt.shMap),ra.data.states={},ra.data.states.s0={},ra.data.states.s0.name="S",ra.data.states.s0.value=o,ra.data.interventions={},ra.data.interventions.t0=0,ra.data.rates={},ra.data.capacitystates={}}else{for(;i!==c;)c=tt.generateFreeID("s");var m;m="m"===u?new je(i,e,a,"special",100):new d(i,e,a),tt.addShape(i,m);for(p=0;p<s.length;)m.nameAddChr(s[p]),p++;switch(u){case"l":m.capacitystate="left",m.lineWidth=2;break;case"r":m.capacitystate="right",m.lineWidth=.5}tt.draw(),ze.callback(tt.shMap),ra.data.states[i]={},ra.data.states[i].name=m.name,ra.data.states[i].value=o,"m"===u&&(ra.data.capacitystates[i]={},ra.data.capacitystates[i].name=m.name,ra.data.capacitystates[i].value=o)}":"!==t[r]&&r++}r+=2;var f="",b="";for(s=[],n="";";"!==t[r]&&":"!==t[r];){for(h="","l"===t[r]&&(r+=15,h="left"),"r"===t[r]&&(r+=16,h="right"),f="",b="",s=[],n="";","!==t[r];){for(n="";"-"!==t[r]&&","!==t[r];)n+=t[r],r++;switch(n[0]){case"(":n=n.substring(1,n.length-1),s.push("("),s.push(n),s.push(")");break;case"+":s.push("+");break;default:s.push(n)}","!==t[r]&&r++}for(s.push(","),n="",r++;","!==t[r];)n+=t[r],r++;for(f+=n,f=tt.getShape(f),r++,n="";";"!==t[r]&&":"!==t[r];)n+=t[r],r++;var v;if(b+=n,b=tt.getShape(b),"left"===h){const t=tt.generateFreeID("t");(v=new ct(t,f,b)).capacitystate="left",v.lineWidth=2,tt.addShape(t,v)}else if("right"===h){const t=tt.generateFreeID("t");(v=new ct(t,f,b)).capacitystate="right",v.lineWidth=.5,tt.addShape(t,v)}else v=ft.transitionCreate(f,b);ze.systemStateActivate("tr",v);for(p=0;","!==s[p];){var g="";switch(s[p]){case"+":ze.activeShape.nameAddToken("o",65291),p++;break;case"(":for(p++;")"!==s[p];)g+=s[p],p++;g=tt.getShape(g),ze.activeShape.nameAddToken("s",g),p++;break;default:ze.activeShape.nameAddToken("r",parseInt(s[p])),p++}}ze.activeShape.deactivate(),ze.systemStateActivate("i"),tt.draw(),ze.callback(tt.shMap),":"!==t[r]&&r++}r+=2;f="",b="";for(s=[],n="";";"!==t[r]&&":"!==t[r];){for(f="",b="",s=[],n="";","!==t[r];){for(n="";"-"!==t[r]&&","!==t[r];)n+=t[r],r++;switch(n[0]){case"(":n=n.substring(1,n.length-1),s.push("("),s.push(n),s.push(")");break;case"+":s.push("+");break;default:s.push(n)}","!==t[r]&&r++}for(s.push(","),r++,n="";";"!==t[r]&&":"!==t[r];)n+=t[r],r++;b+=n,b=tt.getShape(b),ze.systemStateActivate("t",b),Xe.specialArrowCreate("in");for(p=0;","!==s[p];){g="";switch(s[p]){case"+":ze.activeShape.nameAddToken("o",65291),p++;break;case"(":for(p++;")"!==s[p];)g+=s[p],p++;g=tt.getShape(g),ze.activeShape.nameAddToken("s",g),p++;break;default:ze.activeShape.nameAddToken("r",parseInt(s[p])),p++}}ze.activeShape.deactivate(),ze.systemStateActivate("i"),tt.draw(),ze.callback(tt.shMap),":"!==t[r]&&r++}r+=2;var y,S,I,k;f="",b="";for(s=[],n="";";"!==t[r]&&":"!==t[r];){for(f="",b="",s=[],n="";","!==t[r];){for(n="";"-"!==t[r]&&","!==t[r];)n+=t[r],r++;switch(n[0]){case"(":n=n.substring(1,n.length-1),s.push("("),s.push(n),s.push(")");break;case"+":s.push("+");break;default:s.push(n)}","!==t[r]&&r++}for(s.push(","),r++,n="";";"!==t[r]&&":"!==t[r];)n+=t[r],r++;f+=n,f=tt.getShape(f),ze.systemStateActivate("t",f),Xe.specialArrowCreate("out");for(p=0;","!==s[p];){g="";switch(s[p]){case"+":ze.activeShape.nameAddToken("o",65291),p++;break;case"(":for(p++;")"!==s[p];)g+=s[p],p++;g=tt.getShape(g),ze.activeShape.nameAddToken("s",g),p++;break;default:ze.activeShape.nameAddToken("r",parseInt(s[p])),p++}}ze.activeShape.deactivate(),ze.systemStateActivate("i"),tt.draw(),ze.callback(tt.shMap),":"!==t[r]&&r++}for(r+=2;":"!==t[r];){for(y="",S="";"-"!==t[r];)y+=t[r],r++;for(r++;","!==t[r]&&":"!==t[r];)S+=t[r],r++;S=parseFloat(S),":"!==t[r]&&r++,ra.data.interventions[y]=S}for(r+=2;":"!==t[r];){for(I="",y="",k="";","!==t[r];)I+=t[r],r++;for(I=String.fromCodePoint(I),r++;","!==t[r];)y+=t[r],r++;for(r++;":"!==t[r]&&";"!==t[r];)k+=t[r],r++;k=parseFloat(k),":"!==t[r]&&r++,void 0===ra.data.rates[I]&&(ra.data.rates[I]={}),ra.data.rates[I][y]=k}ra.load(),document.getElementById("uploadmodel").style.backgroundColor="lightgreen",$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#cstatesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").show(),$("#helpID").hide(),$("#Simulator").removeClass("active"),$("#Designer").removeClass("active"),$("#UploadDownload").addClass("active")}else alert("wrong data input")}function ya(t,e,a){var s=new Blob([t],{type:a});if(window.navigator.msSaveOrOpenBlob)window.navigator.msSaveOrOpenBlob(s,e);else{var n=document.createElement("a"),i=URL.createObjectURL(s);n.href=i,n.download=e,document.body.appendChild(n),n.click(),setTimeout((function(){document.body.removeChild(n),window.URL.revokeObjectURL(i)}),0)}}function Sa(){let t="<div>Select states to fit:</div>",e="",a="";t+='<label class="switch">',t+='<input type="checkbox" id="fittingcheckn" name="fittingcheckn"> N',t+='<span class="slidern round"></span></label><span style="font-family:\'Arial\';"> ',t+="N",t+="(t)  &nbsp&nbsp</span><br>",Object.keys(ra.states).forEach(e=>{t+='<label class="switch">',t+='<input type="checkbox" id="fittingcheck'+e+'" name="fittingcheck'+e+'"> '+e,t+='<span class="slider'+e+' round"></span></label><span style="font-family:\'Arial\';"> ',t+=ra.states[e].name,t+="(t)  &nbsp&nbsp</span><br>"}),t+="<div>Select your susceptible compartment:</div>";let s=!0;Object.keys(ra.states).forEach(e=>{t+='<label class="switch">',t+='<input type="checkbox" id="scompartment'+e+'" name="scompartment'+e+'"',s&&(t+=" checked",s=!1),t+="> "+e,t+='<span class="slider'+e+' round"></span></label><span style="font-family:\'Arial\';"> ',t+=ra.states[e].name,t+="(t)  &nbsp&nbsp</span><br>"}),t+='<button id="fittingchoicevalidate" class="downloadupload" style="margin-right: 6px; width: 97px">Accept</button>',t+='<button id="fittingchoicecancel" class="downloadupload" style="width: 97px">Cancel</button>',$("#fittingchoice").html(t),Object.keys(ra.states).forEach(t=>{let e="scompartment";e+=t,document.getElementById(e).addEventListener("click",(function(){document.getElementById(e).checked||(document.getElementById(e).checked=!0),Object.keys(ra.states).forEach(e=>{let a="scompartment";a+=e,e!==t&&(document.getElementById(a).checked=!1)})}))}),document.getElementById("fittingchoicevalidate").addEventListener("click",(function(){document.getElementById("fittingcheckn").checked&&(e+='"',e+="n",e+='",'),Object.keys(ra.states).forEach(t=>{let a="fittingcheck";a+=t,document.getElementById(a).checked&&(e+='"',e+=t,e+='",')}),","===e.charAt(e.length-1)&&(e=e.substring(0,e.length-1)),Object.keys(ra.states).forEach(t=>{let e="scompartment";e+=t,document.getElementById(e).checked&&(a+='"',a+=t,a+='",')}),","===a.charAt(a.length-1)&&(a=a.substring(0,a.length-1)),$("#fittingchoice").html(""),function(t,e){fa();var a,s,n,i,o,r,l='{"Model":\n';for([i,o]of(l+='         {"Equations": {',l+='"n": "',Object.keys(ra.states).forEach(t=>{l+=t,l+="+"}),l=l.substring(0,l.length-1),l+='", ',tt.shMap))if("s"===(n=i.substring(0,1))&&void 0===o.max){for([a,s]of(l+='"',l+=i,l+='": "',tt.shMap)){if("t"===(n=a.substring(0,1))&&s.source.id===i&&void 0===s.type){r=0,l+="-",l+=i,l+="*";for(let t=0;t<s.nameArr.length;t++)switch(s.nameArr[t][0]){case"r":l+=s.nameArr[t][1],l+="*";break;case"s":l+=s.nameArr[t][1].id,l+="*","n"!=s.nameArr[t][1].id&&r++;break;case"o":for(;r>0;r--)l+="/n";l+="-",l+=i,l+="*"}for("*"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1));r>0;r--)l+="/n"}if("t"===n&&s.target.id===i&&void 0===s.type){if(void 0!==s.source.max&&"left"===s.capacitystate){let t,e,a=0;Object.keys(ra.states).forEach(t=>{a+=ra.states[t].getValue()});let n="";for([t,e]of(r=0,l+="+",tt.shMap))"t"===t.substring(0,1)&&e.target===s.source&&(l+=e.source.id,l+="*");n+=ra.capacitystates[ra.linktocapacitystate[i]].getValue()/a,n+="-",n+=i,console.log(ra.capacitystates),ra.selectedfunction[ra.linktocapacitystate[i]].expfct?l+=va.capacitystatefunctions.expfct(n):ra.selectedfunction[ra.linktocapacitystate[i]].sqrfct?l+=va.capacitystatefunctions.sqrfct(n):ra.selectedfunction[ra.linktocapacitystate[i]].arctanfct&&(l+=va.capacitystatefunctions.arctanfct(n)),l+="*"}else if(void 0!==s.source.max&&"right"===s.capacitystate){let t,e,a=0;Object.keys(ra.states).forEach(t=>{a+=ra.states[t].getValue()});let n="";for([t,e]of(r=0,l+="+",tt.shMap))"t"===t.substring(0,1)&&e.target===s.source&&(l+=e.source.id,l+="*");n+=ra.capacitystates[ra.linktocapacitystate[i]].getValue()/a,n+="-",n+=ra.linktcstateleftstate[ra.linktocapacitystate[i]],l+="(1-",ra.selectedfunction[ra.linktocapacitystate[i]].expfct?l+=va.capacitystatefunctions.expfct(n):ra.selectedfunction[ra.linktocapacitystate[i]].sqrfct?l+=va.capacitystatefunctions.sqrfct(n):ra.selectedfunction[ra.linktocapacitystate[i]].arctanfct&&(l+=va.capacitystatefunctions.arctanfct(n)),l+=")*"}else r=0,l+="+",l+=s.source.id,l+="*";for(let t=0;t<s.nameArr.length;t++)switch(s.nameArr[t][0]){case"r":l+=s.nameArr[t][1],l+="*";break;case"s":l+=s.nameArr[t][1].id,l+="*","n"!=s.nameArr[t][1].id&&r++;break;case"o":for(;r>0;r--)l+="/n";l+="+",l+=s.source.id,l+="*"}for("*"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1));r>0;r--)l+="/n"}if("t"===n&&s.source.id===i&&"out"===s.type){r=-1,l+="-";for(let t=0;t<s.nameArr.length;t++)switch(s.nameArr[t][0]){case"r":l+=s.nameArr[t][1],l+="*";break;case"s":l+=s.nameArr[t][1].id,l+="*","n"!=s.nameArr[t][1].id&&r++;break;case"o":for(;r>0;r--)l+="/n";l+="-",l+=i,l+="*"}for("*"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1));r>0;r--)l+="/n"}if("t"===n&&s.target.id===i&&"in"===s.type){r=-1,l+="+";for(let t=0;t<s.nameArr.length;t++)switch(s.nameArr[t][0]){case"r":l+=s.nameArr[t][1],l+="*";break;case"s":l+=s.nameArr[t][1].id,l+="*","n"!=s.nameArr[t][1].id&&r++;break;case"o":for(;r>0;r--)l+="/n";l+="+",l+=s.source.id,l+="*"}for("*"===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1));r>0;r--)l+="/n"}}l+='", '}l=l.substring(0,l.length-2),l+='},\n          "Parameters": [',Object.keys(ra.rates).forEach(t=>{l+='"',l+=t.codePointAt(0),l+='",'}),","===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),l+="],\n",l+='          "state_ids": [',Object.keys(ra.states).forEach(t=>{l+='"',l+=t,l+='"',l+=","}),","===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),l+="],\n",l+='          "state-names": {',Object.keys(ra.states).forEach(t=>{l+='"',l+=t,l+='"',l+=":",l+='"';for(let e=0;e<ra.states[t].name.length;e++){let a=ra.states[t].name.codePointAt(e);Object.keys(c.L.C).forEach(t=>{c.L.C[t]===a?l+=t:c.L.S[t]===a&&(l+=t.toLowerCase())})}l+='"',l+=","}),","===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),l+="},\n",l+='          "rates-names": {',Object.keys(ra.rates).forEach(t=>{l+='"',l+=t.codePointAt(0),l+='"',l+=":",l+='"',l+=c.greek.S[t.codePointAt(0)],l+='"',l+=","}),","===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),l+="},\n",l+='          "IV": [',Object.keys(ra.states).forEach(t=>{l+=ra.states[t].getValue(),l+=","}),","===l.charAt(l.length-1)&&(l=l.substring(0,l.length-1)),l+='],\n          "Compartments_to_Fit": [',l+=t,l+='],\n          "Susceptibles": ',l+=e,l+=',\n          "n": ';var d=0;Object.keys(ra.states).forEach(t=>{d+=ra.states[t].getValue()}),l+=d,ya(l+="}\n}","EMD-model.json",/text.*/)}(e,a)})),document.getElementById("fittingchoicecancel").addEventListener("click",(function(){$("#fittingchoice").html("")}))}va.capacitystatefunctions=[],va.capacitystatefunctions.expfct=function(t){return"(1-exp(-("+t+")*("+t+")*1/n))"},va.capacitystatefunctions.sqrfct=function(t){return"(1-1/sqrt(1+("+t+")*("+t+")*1/n))"},va.capacitystatefunctions.arctanfct=function(t){return"(1-1/(1+atan("+t+")*atan("+t+")))"};const Ia={SIR:"",SIS:"",SEIR:"",SIRS:"",SIRD:"",SIRV:"",MSEIR:"",SIHRD:"",SEIRVG:""},ka={SIRvitaldynamics:"",SISvitaldynamics:"",SEIRvitaldynamics:"",SIRSvitaldynamics:"",SIRDvitaldynamics:"",SIRVvitaldynamics:"",MSEIRvitaldynamics:"",SIHRDvitaldynamics:"",SEIRVGvitaldynamics:""};Ia.SIR="Epidemic-Model-Data\n",Ia.SIR+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(500,100),0,119877:\n",Ia.SIR+="120573-(s1),s0,s1;120574,s1,s2:\n",Ia.SIR+=":\n",Ia.SIR+=":\n",Ia.SIR+="t0-0:\n",Ia.SIR+="120573,t0,0.3;120574,t0,0.1:",Ia.SIS="Epidemic-Model-Data\n",Ia.SIS+="s0(100,100),1000,119878;s1(300,100),10,119868:\n",Ia.SIS+="120573-(s1),s0,s1;120574,s1,s0:\n",Ia.SIS+=":\n",Ia.SIS+=":\n",Ia.SIS+="t0-0:\n",Ia.SIS+="120573,t0,0.2;120574,t0,0.1:\n",Ia.SEIR="Epidemic-Model-Data\n",Ia.SEIR+="s0(100,100),1000,119878;s1(300,100),0,119864;s2(500,100),10,119868;s3(700,100),0,119877:\n",Ia.SEIR+="120573-(s2),s0,s1;120572,s1,s2;120574,s2,s3:\n",Ia.SEIR+=":\n",Ia.SEIR+=":\n",Ia.SEIR+="t0-0:\n",Ia.SEIR+="120573,t0,0.3;120572,t0,0.1;120574,t0,0.1:\n",Ia.SIRS="Epidemic-Model-Data\n",Ia.SIRS+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(450,300),0,119877:\n",Ia.SIRS+="120573-(s1),s0,s1;120574,s1,s2;120591,s2,s0:\n",Ia.SIRS+=":\n",Ia.SIRS+=":\n",Ia.SIRS+="t0-0:\n",Ia.SIRS+="120573,t0,0.4;120574,t0,0.2;120591,t0,0.01:\n",Ia.SIRD="Epidemic-Model-Data\n",Ia.SIRD+="s0(100,200),1000,119878;s1(300,200),10,119868;s2(500,100),0,119877;s3(500,300),0,119863:\n",Ia.SIRD+="120573-(s1),s0,s1;120574,s1,s2;120575,s1,s3:\n",Ia.SIRD+=":\n",Ia.SIRD+=":\n",Ia.SIRD+="t0-0:\n",Ia.SIRD+="120573,t0,0.3;120574,t0,0.1;120575,t0,0.005:\n",Ia.SIRV="Epidemic-Model-Data\n",Ia.SIRV+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(500,100),0,119877;s3(200,200),0,119881:\n",Ia.SIRV+="120573-(s1),s0,s1;120574,s1,s2;120575,s0,s3:\n",Ia.SIRV+=":\n",Ia.SIRV+=":\n",Ia.SIRV+="t0-0:\n",Ia.SIRV+="120573,t0,0.3;120574,t0,0.1;120575,t0,0.01:\n",Ia.MSEIR="Epidemic-Model-Data\n",Ia.MSEIR+="s0(100,100),100,119872;s1(300,100),900,119878;s2(500,100),0,119864;s3(700,100),1,119868;s4(900,100),0,119877:\n",Ia.MSEIR+="120575,s0,s1;120573-(s3),s1,s2;120572,s2,s3;120574,s3,s4:\n",Ia.MSEIR+=":\n",Ia.MSEIR+=":\n",Ia.MSEIR+="t0-0:\n",Ia.MSEIR+="120575,t0,0.01;120573,t0,0.3;120572,t0,0.1;120574,t0,0.1:\n",Ia.SIHRD="Epidemic-Model-Data\n",Ia.SIHRD+="s0(250,50),1000,119878;s1(250,250),10,119868;maincstates2(400,400),100,119870;leftcstates3(250,550),0,119867;rightcstates4(550,550),0,119863;s5(100,400),0,119877:\n",Ia.SIHRD+="leftctransition120582,s2,s3;rightctransition120582,s2,s4;120573-(s1),s0,s1;120582,s1,s2;120581,s3,s5;120591,s1,s5:\n",Ia.SIHRD+=":\n",Ia.SIHRD+=":\n",Ia.SIHRD+="t0-0:\n",Ia.SIHRD+="120573,t0,0.5;120582,t0,0.11;120591,t0,0.1;120581,t0,0.1:\n",Ia.SEIRVG="Epidemic-Model-Data\n",Ia.SEIRVG+="s0(120,216),499.99999999999994,119878,8321;s1(307,212),0,119864,8321;s2(485,211),10,119868,8321;s3(482,341),0,119877,8321;s4(625,227),0,119866,8321;s5(133,458),499.99999999999994,119878,8322;s6(304,457),0,119864,8322;s7(485,461),10,119868,8322;s8(488,575),0,119877,8322;s9(650,462),0,119866,8322;s10(477,97),0,119881;s11(605,93),0,119881,119866:\n",Ia.SEIRVG+="120573-(s2),s0,s1;120572,s1,s2;120574,s2,s3;120584,s3,s0;120583-+-120582,s3,s4;120581,s4,s3;120573-(s7),s5,s6;120572,s6,s7;120574,s7,s8;120584,s8,s5;120583,s8,s9;120581,s9,s8;120576,s10,s0;120580,s0,s10;120593-+-120596,s10,s11;120590,s11,s10:\n",Ia.SEIRVG+=":\n",Ia.SEIRVG+=":\n",Ia.SEIRVG+="t0-0,t1-45,t2-75:\n",Ia.SEIRVG+="120573,t0,0.6;120573,t1,0.3;120573,t2,0.7;120584,t0,0.05;120584,t1,0.09;120584,t2,0.09;120572,t0,0.5;120572,t1,0.3;120572,t2,0.3;120574,t0,0.07;120574,t1,0.2;120574,t2,0.07;120583,t0,0.05;120583,t1,0.05;120583,t2,0.05;120581,t0,0.1;120581,t1,0.1;120581,t2,0.1;120576,t0,0.1;120576,t1,0.1;120576,t2,0.1;120580,t0,0;120580,t1,0.3;120580,t2,0.3;120593,t0,0.001;120593,t1,0.001;120593,t2,0.001;120590,t0,0.1;120590,t1,0.1;120590,t2,0.1;120582,t0,0.01;120582,t1,0.01;120582,t2,0.01;120596,t0,0.05;120596,t1,0.05;120596,t2,0.05:\n",ka.SIRvitaldynamics="Epidemic-Model-Data\n",ka.SIRvitaldynamics+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(500,100),0,119877:\n",ka.SIRvitaldynamics+="120573-(s1),s0,s1;120574,s1,s2:\n",ka.SIRvitaldynamics+="120583-(n),s0:\n",ka.SIRvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2:\n",ka.SIRvitaldynamics+="t0-0:\n",ka.SIRvitaldynamics+="120573,t0,0.3;120574,t0,0.1;120583,t0,0.01;120584,t0,0.01:\n",ka.SISvitaldynamics="Epidemic-Model-Data\n",ka.SISvitaldynamics+="s0(100,100),1000,119878;s1(300,100),10,119868:\n",ka.SISvitaldynamics+="120573-(s1),s0,s1;120574,s1,s0:\n",ka.SISvitaldynamics+="120583-(n),s0:\n",ka.SISvitaldynamics+="120584-(s0),s0;120584-(s1),s1:\n",ka.SISvitaldynamics+="t0-0:\n",ka.SISvitaldynamics+="120573,t0,0.2;120574,t0,0.1;120583,t0,0.001;120584,t0,0.001:\n",ka.SEIRvitaldynamics="Epidemic-Model-Data\n",ka.SEIRvitaldynamics+="s0(100,100),1000,119878;s1(300,100),0,119864;s2(500,100),10,119868;s3(700,100),0,119877:\n",ka.SEIRvitaldynamics+="120573-(s2),s0,s1;120572,s1,s2;120574,s2,s3:\n",ka.SEIRvitaldynamics+="120583-(n),s0:\n",ka.SEIRvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2;120584-(s3),s3:\n",ka.SEIRvitaldynamics+="t0-0:\n",ka.SEIRvitaldynamics+="120573,t0,0.3;120572,t0,0.1;120574,t0,0.1;120583,t0,0.001;120584,t0,0.001:\n",ka.SIRSvitaldynamics="Epidemic-Model-Data\n",ka.SIRSvitaldynamics+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(450,300),0,119877:\n",ka.SIRSvitaldynamics+="120573-(s1),s0,s1;120574,s1,s2;120591,s2,s0:\n",ka.SIRSvitaldynamics+="(n)-120583,s0:\n",ka.SIRSvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2:\n",ka.SIRSvitaldynamics+="t0-0:\n",ka.SIRSvitaldynamics+="120573,t0,0.4;120574,t0,0.2;120591,t0,0.01;120583,t0,0.001;120584,t0,0.001:\n",ka.SIRDvitaldynamics="Epidemic-Model-Data\n",ka.SIRDvitaldynamics+="s0(100,200),1000,119878;s1(300,200),10,119868;s2(500,100),0,119877;s3(500,300),0,119863:\n",ka.SIRDvitaldynamics+="120573-(s1),s0,s1;120574,s1,s2;120575,s1,s3:\n",ka.SIRDvitaldynamics+="120583-(s0)-+-120583-(s1)-+-120583-(s2),s0:\n",ka.SIRDvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2:\n",ka.SIRDvitaldynamics+="t0-0:\n",ka.SIRDvitaldynamics+="120573,t0,0.3;120574,t0,0.1;120575,t0,0.005;120583,t0,0.01;120584,t0,0.01:\n",ka.SIRVvitaldynamics="Epidemic-Model-Data\n",ka.SIRVvitaldynamics+="s0(100,100),1000,119878;s1(300,100),10,119868;s2(500,100),0,119877;s3(200,200),0,119881:\n",ka.SIRVvitaldynamics+="120573-(s1),s0,s1;120574,s1,s2;120575,s0,s3:\n",ka.SIRVvitaldynamics+="120583-(n),s0:\n",ka.SIRVvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2;120584-(s3),s3:\n",ka.SIRVvitaldynamics+="t0-0:\n",ka.SIRVvitaldynamics+="120573,t0,0.3;120574,t0,0.1;120575,t0,0.01;120583,t0,0.01;120584,t0,0.01:\n",ka.MSEIRvitaldynamics="Epidemic-Model-Data\n",ka.MSEIRvitaldynamics+="s0(100,100),100,119872;s1(300,100),900,119878;s2(500,100),0,119864;s3(700,100),1,119868;s4(900,100),0,119877:\n",ka.MSEIRvitaldynamics+="120575,s0,s1;120573-(s3),s1,s2;120572,s2,s3;120574,s3,s4:\n",ka.MSEIRvitaldynamics+="120583-(s0)-+-120583-(s2)-+-120583-(s3)-+-120583-(s4),s0;120583-(s1),s1:\n",ka.MSEIRvitaldynamics+="120584-(s0),s0;120584-(s1),s1;120584-(s2),s2;120584-(s3),s3;120584-(s4),s4:\n",ka.MSEIRvitaldynamics+="t0-0:\n",ka.MSEIRvitaldynamics+="120575,t0,0.01;120573,t0,0.3;120572,t0,0.1;120574,t0,0.1;120583,t0,0.001;120584,t0,0.001:\n",ka.SIHRDvitaldynamics="Epidemic-Model-Data\n",ka.SIHRDvitaldynamics+="s0(139,118),1000,119878;s1(250,250),10,119868;maincstates2(400,400),100,119870;leftcstates3(250,550),0,119867;rightcstates4(550,550),0,119863;s5(100,400),0,119877:\n",ka.SIHRDvitaldynamics+="leftctransition120582,s2,s3;rightctransition120582,s2,s4;120573-(s1),s0,s1;120582,s1,s2;120581,s3,s5;120591,s1,s5:\n",ka.SIHRDvitaldynamics+="120583-(s0)-+-120583-(s1)-+-120583-(s3)-+-120583-(s5),s0:\n",ka.SIHRDvitaldynamics+="120584-(s1),s1;120584-(s0),s0;120584-(s5),s5;120584-(s3),s3:\n",ka.SIHRDvitaldynamics+="t0-0:\n",ka.SIHRDvitaldynamics+="120573,t0,0.7;120582,t0,0.11;120591,t0,0.1;120581,t0,0.1;120583,t0,0.1;120584,t0,0.1:\n",ka.SEIRVGvitaldynamics="Epidemic-Model-Data\n",ka.SEIRVGvitaldynamics+="s0(123,231),500,119878,8321;s1(307,227),0,119864,8321;s2(482,228),10,119868,8321;s3(564,336),0,119877,8321;s4(625,227),0,119866,8321;s5(121,458),500,119878,8322;s6(304,457),0,119864,8322;s7(485,461),10,119868,8322;s8(560,556),0,119877,8322;s9(650,462),0,119866,8322;s10(477,97),0,119881;s11(615,94),0,119881,119866:\n",ka.SEIRVGvitaldynamics+="120573-(s2),s0,s1;120572,s1,s2;120574,s2,s3;120584,s3,s0;120583-+-120582,s3,s4;120581,s4,s3;120573-(s7),s5,s6;120572,s6,s7;120574,s7,s8;120584,s8,s5;120583,s8,s9;120581,s9,s8;120576,s10,s0;120580,s0,s10;120593-+-120596,s10,s11;120590,s11,s10:\n",ka.SEIRVGvitaldynamics+="120595-(n),s5:\n",ka.SEIRVGvitaldynamics+="120577-(s5),s5;120577-(s6),s6;120577-(s7),s7;120577-(s9),s9;120577-(s8),s8;120577-(s0),s0;120577-(s1),s1;120577-(s10),s10;120577-(s3),s3;120577-(s4),s4;120577-(s11),s11;120577-(s2),s2:\n",ka.SEIRVGvitaldynamics+="t0-0,t1-50:\n",ka.SEIRVGvitaldynamics+="120573,t0,0.3;120573,t1,0.3;120584,t0,0.05;120584,t1,0.05;120572,t0,0.3;120572,t1,0.3;120574,t0,0.07;120574,t1,0.07;120583,t0,0.05;120583,t1,0.05;120581,t0,0.1;120581,t1,0.1;120576,t0,0.1;120576,t1,0.1;120580,t0,0;120580,t1,0.3;120593,t0,0.1;120593,t1,0.001;120590,t0,0.1;120590,t1,0.1;120582,t0,0.01;120582,t1,0.01;120596,t0,0.05;120596,t1,0.05;120595,t0,0.00001;120595,t1,0.00001;120577,t0,0.00001;120577,t1,0.00001:\n";var wa=function(){let t,e="";for(t in e+='<div style="padding-left:130px; margin-bottom: 5px; font-size: 10pt; font-family: Verdana, Geneva, Tahoma, sans-serif;">With vital dynamics:</div>',Ia)e+='<span style="padding-bottom:5px; display:block;">',e+='<button id="',e+=t,e+='" style="width:100px; margin-right: 50px;" class="downloadupload">',e+=t,e+="</button>",e+='<button id="',e+=t,e+="vitaldynamics",e+='" style="width:100px;" class="downloadupload">',e+=t,e+="</button>",e+="</span>";for(t in e+='<div style="margin-bottom: 5px; margin-top: 10px; font-size: 10pt; font-family: Verdana, Geneva, Tahoma, sans-serif;">Create by number of states:</div>',e+='<input type="number" id="numberstates" min="1" value="1" style="background-color: lightgrey; width: 40px;">',e+='<button id="createwithnumber" style="width:55px; margin-left: 10px;" class="downloadupload">Create</button>',e+='<button id="createwithnumbertransitons" style="width:150px; margin-left: 10px;" class="downloadupload">Create with transitions</button>',document.getElementById("defaultmodelscontent").innerHTML=e,Ia){let e=t,a=t;a+="vitaldynamics",document.getElementById(e).addEventListener("click",(function(){"s1"===tt.generateFreeID("s")?(ga(Ia[e]),$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active")):alert("There is an acitve model running! \nPlease refresh the website.")})),document.getElementById(a).addEventListener("click",(function(){"s1"===tt.generateFreeID("s")?(ga(ka[a]),$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active")):alert("There is an acitve model running! \nPlease refresh the website.")}))}document.getElementById("createwithnumber").addEventListener("click",(function(){let t=document.getElementById("numberstates").value;if(t<1)return;if("s1"!==tt.generateFreeID("s"))return void alert("There is an acitve model running! \nPlease refresh the website.");let e="Epidemic-Model-Data\n",a=100,s=0,n="",i="";for(let o=0;o<t;o++)o%4==0&&(s+=100,a=100),n="s",n+=o,i=119860+o,e+=n,e+="(",e+=a,e+=",",e+=s,e+="),",e+=0===o?"1000,":"0,",e+=i,e+=";",a+=200;e=e.substring(0,e.length-1),e+=":\n:\n:\n:\nt0-0:\n:\n",ga(e),$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active")})),document.getElementById("createwithnumbertransitons").addEventListener("click",(function(){let t=document.getElementById("numberstates").value;if(t<1)return;if("s1"!==tt.generateFreeID("s"))return void alert("There is an acitve model running! \nPlease refresh the website.");let e,a="Epidemic-Model-Data\n",s=100,n=0,i="",o="",r="";for(let e=0;e<t;e++)e%4==0&&(n+=100,s=100),i="s",i+=e,r=119860+e,a+=i,a+="(",a+=s,a+=",",a+=n,a+="),",a+=0===e?"1000,":"0,",a+=r,a+=";",s+=200;a=a.substring(0,a.length-1),a+=":\n";for(let s=0;s<t-1;s++)i="s",i+=s,o="s",o+=s+1,e=120572+s,a+=e,a+=",",a+=i,a+=",",a+=o,a+=";";a=a.substring(0,a.length-1),a+=":\n:\n:\nt0-0:\n";for(let s=0;s<t-1;s++)e=120572+s,a+=e,a+=",",a+="t0,",a+="0.1;";a=a.substring(0,a.length-1),a+=":\n",ga(a),$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active")}))};function Da(){JXG.Options=JXG.merge(JXG.Options,{board:{showNavigation:!1,showCopyright:!1,useMathJax:!0}}),JXG.Options.text.useMathJax=!0,ra.board=JXG.JSXGraph.initBoard("plotID",{boundingbox:[-20,1.2,220,-.1],axis:!1,keepaspectratio:!1,showCopyright:!1,showNavigation:!1,zoom:{factorX:1.25,factorY:1.25,wheel:!0,needshift:!1,eps:.1}}),ca(),ba(),la(),ma(),ra.plotCurves(),wa()}function Ca(){$("#Designer").click(()=>{$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#cstatesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").removeClass("active"),$("#Designer").addClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active")}),$("#Simulator").click(()=>{$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#helpID").show(),$("#plotID").show(),$("#tab2ID").show(),$("#GraphButtons").show(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").hide(),$("#Simulator").addClass("active"),$("#Designer").removeClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").removeClass("active"),Object.values(ra.rates).forEach(t=>{t.board.update()})}),$("#Defaultmodels").click(()=>{$("#fsmID").show(),$("#odeID").show(),$("#inID").show(),$("#helpID").show(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#cstatesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").hide(),$("#defaultmodelscontent").show(),$("#Simulator").removeClass("active"),$("#Designer").removeClass("active"),$("#UploadDownload").removeClass("active"),$("#Defaultmodels").addClass("active")}),$("#UploadDownload").click(()=>{$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#plotID").hide(),$("#tab2ID").hide(),$("#statesID").hide(),$("#cstatesID").hide(),$("#ratesID").hide(),$("#tab3ID").hide(),$("#GraphButtons").hide(),$("#downloaduploadID").show(),$("#defaultmodelscontent").hide(),$("#helpID").hide(),$("#Simulator").removeClass("active"),$("#Designer").removeClass("active"),$("#UploadDownload").addClass("active"),$("#Defaultmodels").removeClass("active")}),$("#uploadmodel").change(()=>{!function(){if("s1"!==tt.generateFreeID("s"))return alert("There is an acitve model running! \nPlease refresh the website before the upload."),void(document.getElementById("uploadmodel").style.backgroundColor="red");const t=document.getElementById("uploadmodel").files[0];if(t.type.match(/text.*/)){const e=new FileReader;e.onload=function(t){ga(e.result)},e.readAsText(t)}else alert("Error with your datatype")}()}),$("#downloadmodel").click(()=>{!function(){var t,e,a="Epidemic-Model-Data\n";for([t,e]of tt.shMap)"s"===t.substring(0,1)&&(void 0!==e.max&&(a+="maincstate"),"left"===e.capacitystate&&(a+="leftcstate"),"right"===e.capacitystate&&(a+="rightcstate"),a+=t,a+="(",a+=e.x,a+=",",a+=e.y,a+=")",a+=",",void 0!==ra.states[t]||null!=e.max&&void 0!==ra.capacitystates[t]?void 0!==e.max?a+=ra.capacitystates[t].getValue():a+=ra.states[t].getValue():void 0!==e.max?a+="100":a+="0",a+=",",a+=e.nameArr,a+=";");for([t,e]of(a=a.substring(0,a.length-1),a+=":",a+="\n",tt.shMap))if("t"===t.substring(0,1)&&void 0===e.type){"left"===e.capacitystate&&(a+="leftctransition"),"right"===e.capacitystate&&(a+="rightctransition");for(let t=0;t<e.nameArr.length;t++)switch(e.nameArr[t][0]){case"r":a+=e.nameArr[t][1],a+="-";break;case"s":a+="(",a+=e.nameArr[t][1].id,a+=")",a+="-";break;case"o":a+="+",a+="-"}a=a.substring(0,a.length-1),a+=",",a+=e.source.id,a+=",",a+=e.target.id,a+=";"}for([t,e]of(":"!==a.charAt(a.length-1)&&"\n"!==a.charAt(a.length-1)?(a=a.substring(0,a.length-1),a+=":"):a+=":",a+="\n",tt.shMap))if("t"===t.substring(0,1)&&"in"===e.type){for(let t=0;t<e.nameArr.length;t++)switch(e.nameArr[t][0]){case"r":a+=e.nameArr[t][1],a+="-";break;case"s":a+="(",a+=e.nameArr[t][1].id,a+=")",a+="-";break;case"o":a+="+",a+="-"}a=a.substring(0,a.length-1),a+=",",a+=e.target.id,a+=";"}for([t,e]of(":"!==a.charAt(a.length-1)&&"\n"!==a.charAt(a.length-1)?(a=a.substring(0,a.length-1),a+=":"):a+=":",a+="\n",tt.shMap))if("t"===t.substring(0,1)&&"out"===e.type){for(let t=0;t<e.nameArr.length;t++)switch(e.nameArr[t][0]){case"r":a+=e.nameArr[t][1],a+="-";break;case"s":a+="(",a+=e.nameArr[t][1].id,a+=")",a+="-";break;case"o":a+="+",a+="-"}a=a.substring(0,a.length-1),a+=",",a+=e.source.id,a+=";"}":"!==a.charAt(a.length-1)&&"\n"!==a.charAt(a.length-1)?(a=a.substring(0,a.length-1),a+=":"):a+=":",a+="\n",Object.keys(ra.interventions).forEach(t=>{a+=t,a+="-",a+=ra.interventions[t].getValue(),a+=","}),":"!==a.charAt(a.length-1)&&"\n"!==a.charAt(a.length-1)?(a=a.substring(0,a.length-1),a+=":"):a+=":",a+="\n",Object.keys(ra.rates).forEach(t=>{Object.keys(ra.interventions).forEach(e=>{a+=t.codePointAt(0),a+=",",a+=e,a+=",",a+=ra.rates[t][e].getValue(),a+=";"})}),":"!==a.charAt(a.length-1)&&"\n"!==a.charAt(a.length-1)?(a=a.substring(0,a.length-1),a+=":"):a+=":",ya(a,"EMD-download.txt",/text.*/)}()}),$("#downloaddatacsv").click(()=>{!function(){const t=fa();var e,a,s="population,";for([e,a]of tt.shMap){if("s"===e.substring(0,1)&&void 0===a.max){for(let t=0;t<a.name.length;t++){let e=a.name.codePointAt(t);Object.keys(c.L.C).forEach(t=>{c.L.C[t]===e?s+=t:c.L.S[t]===e&&(s+=t.toLowerCase())})}s+=","}}s+="\n";for(let e=0;e<t.length;e++){var n=t[e].pop();Number.isInteger(n)&&(s+=t[e],s+=",",s+="\n")}ya(s,"EMD-data.csv",/text.*/)}()}),$("#downloadmodeljson").click(()=>{Sa()}),$("#downloadfittingprogram").click(()=>{window.open("https://github.com/Kilian672/EMD-Code/blob/main/App.exe","_blank").focus()}),$("#Rates").click(()=>{$("#ratesID").show(),$("#tab3ID").show(),$("#statesID").hide(),$("#cstatesID").hide(),$("#Rates").addClass("active"),$("#Values").removeClass("active"),Object.values(ra.rates).forEach(t=>{t.board.update()})}),$("#Values").click(()=>{$("#ratesID").hide(),$("#tab3ID").hide(),$("#statesID").show(),$("#cstatesID").show(),$("#Values").addClass("active"),$("#Rates").removeClass("active"),Object.values(ra.states).forEach(t=>{t.board.update()}),document.getElementById("cstatesID").focus()})}document.addEventListener("DOMContentLoaded",()=>{Ca(),document.getElementById("Designer").click(),oa.init(),document.getElementById("Simulator").click(),document.getElementById("Rates").click(),$("#Simulator").click(t=>{$("#fsmID").hide(),$("#odeID").hide(),$("#inID").hide(),$("#plotID").show(),$("#tab2ID").show(),$("#GraphButtons").show(),$("#Simulator").addClass("active"),$("#Designer").removeClass("active"),0!==Object.keys(ra).length&&ra.update(),document.getElementById("Rates").click()}),Da(),document.getElementById("Designer").click()})}]);